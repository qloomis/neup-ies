

<!doctype html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>simulations.dispatch.SolarDispatch &#8212; NE-2 Simulations  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/bizstyle.css" />
    
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">NE-2 Simulations  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">simulations.dispatch.SolarDispatch</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for simulations.dispatch.SolarDispatch</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Pyomo real-time dispatch model</span>


<span class="sd">Model authors:</span>
<span class="sd">* Mike Wagner - UW-Madison</span>
<span class="sd">* Bill Hamilton - NREL </span>
<span class="sd">* John Cox - Colorado School of Mines</span>
<span class="sd">* Alex Zolan - NREL</span>

<span class="sd">Pyomo code by Alex Zolan</span>
<span class="sd">Modified by Gabriel Soto</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">pyomo.environ</span> <span class="k">as</span> <span class="nn">pe</span>
<span class="kn">from</span> <span class="nn">dispatch.GeneralDispatch</span> <span class="kn">import</span> <span class="n">GeneralDispatch</span>
<span class="kn">from</span> <span class="nn">dispatch.GeneralDispatch</span> <span class="kn">import</span> <span class="n">GeneralDispatchParamWrap</span>
<span class="kn">from</span> <span class="nn">dispatch.NuclearDispatch</span> <span class="kn">import</span> <span class="n">NuclearDispatch</span>
<span class="kn">from</span> <span class="nn">dispatch.NuclearDispatch</span> <span class="kn">import</span> <span class="n">NuclearDispatchParamWrap</span>
<span class="kn">from</span> <span class="nn">dispatch.IndirectNuclearDispatch</span> <span class="kn">import</span> <span class="n">IndirectNuclearDispatch</span>
<span class="kn">from</span> <span class="nn">dispatch.IndirectNuclearDispatch</span> <span class="kn">import</span> <span class="n">IndirectNuclearDispatchParamWrap</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">util.FileMethods</span> <span class="kn">import</span> <span class="n">FileMethods</span>
<span class="kn">from</span> <span class="nn">util.SSCHelperMethods</span> <span class="kn">import</span> <span class="n">SSCHelperMethods</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">copy</span>

<div class="viewcode-block" id="SolarDispatch"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.SolarDispatch.SolarDispatch">[docs]</a><span class="k">class</span> <span class="nc">SolarDispatch</span><span class="p">(</span><span class="n">IndirectNuclearDispatch</span><span class="p">,</span> <span class="n">NuclearDispatch</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The SolarDispatch class is meant to set up and run Dispatch</span>
<span class="sd">    optimization as a mixed integer linear program problem using Pyomo,</span>
<span class="sd">    specifically for the NuclearTES NE2+SSC module.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="SolarDispatch.__init__"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.SolarDispatch.SolarDispatch.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Initializes the SolarDispatch module</span>
<span class="sd">        </span>
<span class="sd">        The instantiation of this class receives a parameter dictionary from</span>
<span class="sd">        the NE2 module (created using the SolarDispatchWrapper class). It calls</span>
<span class="sd">        on the GeneralDispatch __init__ to create the model. The GeneralDispatcher first</span>
<span class="sd">        creates an empty Concrete Model from Pyomo, then generates Parameters</span>
<span class="sd">        from the parameter dictionary, Variables, Objectives and Constraints.</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">            params (dict)                : dictionary of Pyomo dispatch parameters</span>
<span class="sd">            unitRegistry (pint.registry) : unique unit Pint unit registry</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># check to see if we need to invoke the IndirectNuclear or bypass</span>
        <span class="k">if</span> <span class="s2">&quot;direct&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="c1"># doing indirect TES charging</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># bypassing, we are doing direct TES charging (or solar only)</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">IndirectNuclearDispatch</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="SolarDispatch.generate_params"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.SolarDispatch.SolarDispatch.generate_params">[docs]</a>    <span class="k">def</span> <span class="nf">generate_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">skip_parent</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to generate parameters within Pyomo Solar Model</span>
<span class="sd">        </span>
<span class="sd">        This method reads in a dictionary of pyomo parameters and uses these</span>
<span class="sd">        inputs to initialize parameters for the Pyomo Concrete Model. This method</span>
<span class="sd">        sets up parameters particularly for the Power Cycle. It also defines</span>
<span class="sd">        some lambda functions that helps convert Pint units to Pyomo units. It</span>
<span class="sd">        first instantiates PowerCycle parameters through GeneralDispatch, then</span>
<span class="sd">        instantiates Solar parameters.</span>
<span class="sd">        </span>
<span class="sd">        Note: initial conditions are defined for the time period immediately </span>
<span class="sd">        preceding the start of this new Pyomo time segment. </span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">            params (dict)  : dictionary of Pyomo dispatch parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dual</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">NuclearDispatch</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">generate_params</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direct</span><span class="p">:</span>
                <span class="nb">super</span><span class="p">(</span><span class="n">IndirectNuclearDispatch</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">generate_params</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">generate_params</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        
        <span class="c1"># lambdas to convert units and data to proper syntax</span>
        <span class="n">gd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gd</span>
        <span class="n">gu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gu</span> 
        
        <span class="c1">### Cost Parameters ### </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Crec</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;Crec&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;Crec&quot;</span><span class="p">))</span>              <span class="c1">#C^{rec}: Operating cost of heliostat field and receiver [\$/kWt$\cdot$h]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Crsu</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;Crsu&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;Crsu&quot;</span><span class="p">))</span>              <span class="c1">#C^{rsu}: Penalty for receiver cold start-up [\$/start]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Crhsp</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;Crhsp&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;Crhsp&quot;</span><span class="p">))</span>           <span class="c1">#C^{rhsp}: Penalty for receiver hot start-up [\$/start]</span>
        
        <span class="c1">### CSP Parameters ###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">deltal</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;deltal&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;deltal&quot;</span><span class="p">))</span>    <span class="c1">#\delta^l: Minimum time to start the receiver [hr]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Ehs</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;Ehs&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;Ehs&quot;</span><span class="p">))</span>             <span class="c1">#E^{hs}: Heliostat field startup or shut down parasitic loss [kWe$\cdot$h]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Er</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;Er&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;Er&quot;</span><span class="p">))</span>                <span class="c1">#E^r: Required energy expended to start receiver [kWt$\cdot$h]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Lr</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;Lr&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;Lr&quot;</span><span class="p">))</span>                <span class="c1">#L^r: Receiver pumping power per unit power produced [kWe/kWt]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Qrl</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;Qrl&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;Qrl&quot;</span><span class="p">))</span>             <span class="c1">#Q^{rl}: Minimum operational thermal power delivered by receiver [kWt$\cdot$h]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Qrsb</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;Qrsb&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;Qrsb&quot;</span><span class="p">))</span>          <span class="c1">#Q^{rsb}: Required thermal power for receiver standby [kWt$\cdot$h]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Qrsd</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;Qrsd&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;Qrsd&quot;</span><span class="p">))</span>          <span class="c1">#Q^{rsd}: Required thermal power for receiver shut down [kWt$\cdot$h] </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Qru</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;Qru&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;Qru&quot;</span><span class="p">))</span>             <span class="c1">#Q^{ru}: Allowable power per period for receiver start-up [kWt$\cdot$h]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Wh</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;Wh&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;Wh&quot;</span><span class="p">))</span>                <span class="c1">#W^h: Heliostat field tracking parasitic loss [kWe]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Wht</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;Wht&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;Wht&quot;</span><span class="p">))</span>             <span class="c1">#W^{ht}: Tower piping heat trace parasitic loss [kWe]</span>

        <span class="c1">### Time series CSP Parameters ###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">delta_rs</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;delta_rs&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;delta_rs&quot;</span><span class="p">))</span>     <span class="c1">#\delta^{rs}_{t}: Estimated fraction of period $t$ required for receiver start-up [-]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Qin</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;Qin&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;Qin&quot;</span><span class="p">))</span>                    <span class="c1">#Q^{in}_{t}: Available thermal power generated by the CSP heliostat field in period $t$ [kWt]</span>

        <span class="c1">### Initial Condition Parameters ###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ursu0</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;ursu0&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;ursu0&quot;</span><span class="p">))</span>  <span class="c1">#u^{rsu}_0: Initial receiver start-up energy inventory [kWt$\cdot$h]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">yr0</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;yr0&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;yr0&quot;</span><span class="p">))</span>        <span class="c1">#y^r_0: 1 if receiver is generating ``usable&#39;&#39; thermal power initially, 0 otherwise  [az] this is new.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">yrsb0</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;yrsb0&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;yrsb0&quot;</span><span class="p">))</span>  <span class="c1">#y^{rsb}_0: 1 if receiver is in standby mode initially, 0 otherwise [az] this is new.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">yrsu0</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;yrsu0&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;yrsu0&quot;</span><span class="p">))</span>  <span class="c1">#y^{rsu}_0: 1 if receiver is in starting up initially, 0 otherwise    [az] this is new.</span></div>
        

<div class="viewcode-block" id="SolarDispatch.generate_variables"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.SolarDispatch.SolarDispatch.generate_variables">[docs]</a>    <span class="k">def</span> <span class="nf">generate_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skip_parent</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to generate parameters within Pyomo Solar Model</span>
<span class="sd">        </span>
<span class="sd">        This method instantiates variables for the Pyomo Concrete Model, with</span>
<span class="sd">        domains. Does not need initial guesses here, they are defined in the </span>
<span class="sd">        parameters. We first define continuous and binary variables for the </span>
<span class="sd">        Power Cycle through GeneralDispatch, then declare nuclear variables.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># generating GeneralDispatch variables first (PowerCycle, etc.)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dual</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">NuclearDispatch</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">generate_variables</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direct</span><span class="p">:</span>
                <span class="nb">super</span><span class="p">(</span><span class="n">IndirectNuclearDispatch</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">generate_variables</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">generate_variables</span><span class="p">()</span>
                
        <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_pyomo</span>
        <span class="c1">### Decision Variables ###</span>
        <span class="c1">#------- Variables ---------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ursu</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pe</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">kWh</span><span class="p">)</span>     <span class="c1">#u^{rsu}: Receiver start-up energy inventory at period $t$ [kWt$\cdot$h]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">xr</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pe</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">kW</span><span class="p">)</span>       <span class="c1">#x^r: Thermal power delivered by the receiver at period $t$ [kWt]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">xrsu</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pe</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">kW</span><span class="p">)</span>     <span class="c1">#x^{rsu}: Receiver start-up power consumption at period $t$ [kWt]</span>
        
        <span class="c1">#------- Binary Variables ---------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">yr</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pe</span><span class="o">.</span><span class="n">Binary</span><span class="p">)</span>        <span class="c1">#y^r: 1 if receiver is generating ``usable&#39;&#39; thermal power at period $t$; 0 otherwise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">yrhsp</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pe</span><span class="o">.</span><span class="n">Binary</span><span class="p">)</span>	  <span class="c1">#y^{rhsp}: 1 if receiver hot start-up penalty is incurred at period $t$ (from standby); 0 otherwise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">yrsb</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pe</span><span class="o">.</span><span class="n">Binary</span><span class="p">)</span>	  <span class="c1">#y^{rsb}: 1 if receiver is in standby mode at period $t$; 0 otherwise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">yrsd</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pe</span><span class="o">.</span><span class="n">Binary</span><span class="p">)</span>	  <span class="c1">#y^{rsd}: 1 if receiver is shut down at period $t$; 0 otherwise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">yrsu</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pe</span><span class="o">.</span><span class="n">Binary</span><span class="p">)</span>      <span class="c1">#y^{rsu}: 1 if receiver is starting up at period $t$; 0 otherwise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">yrsup</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pe</span><span class="o">.</span><span class="n">Binary</span><span class="p">)</span>     <span class="c1">#y^{rsup}: 1 if receiver cold start-up penalty is incurred at period $t$ (from off); 0 otherwise</span></div>


<div class="viewcode-block" id="SolarDispatch.add_objective"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.SolarDispatch.SolarDispatch.add_objective">[docs]</a>    <span class="k">def</span> <span class="nf">add_objective</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to add an objective function to the Pyomo Solar Model</span>
<span class="sd">        </span>
<span class="sd">        This method adds an objective function to the Pyomo Solar Dispatch</span>
<span class="sd">        model. Typically, the LORE team defined a nested function and passes it</span>
<span class="sd">        into the Pyomo model. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">objectiveRule</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; Maximize profits vs. costs &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="p">(</span>
                    <span class="nb">sum</span><span class="p">(</span> <span class="n">model</span><span class="o">.</span><span class="n">D</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">*</span> 
                    <span class="c1">#obj_profit</span>
                    <span class="n">model</span><span class="o">.</span><span class="n">Delta</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="mf">0.1</span><span class="o">*</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">wdot_s</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">wdot_p</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
                    <span class="c1">#obj_cost_cycle_su_hs_sd</span>
                    <span class="o">-</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Ccsu</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">ycsup</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">Cchsp</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">ychsp</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">alpha</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">ycsd</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
                    <span class="c1">#obj_cost_cycle_ramping</span>
                    <span class="o">-</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">C_delta_w</span><span class="o">*</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">wdot_delta_plus</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">wdot_delta_minus</span><span class="p">[</span><span class="n">t</span><span class="p">])</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">C_v_w</span><span class="o">*</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">wdot_v_plus</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">wdot_v_minus</span><span class="p">[</span><span class="n">t</span><span class="p">]))</span>
                    <span class="c1">#obj_cost_rec_su_hs_sd</span>
                    <span class="o">-</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Crsu</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">yrsup</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">Crhsp</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">yrhsp</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">alpha</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">yrsd</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
                    <span class="c1">#obj_cost_ops</span>
                    <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">Delta</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Cpc</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">wdot</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">Ccsb</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">Qb</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">ycsb</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">Crec</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">xr</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="p">)</span>
                    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> 
                    <span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">OBJ</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Objective</span><span class="p">(</span><span class="n">rule</span><span class="o">=</span><span class="n">objectiveRule</span><span class="p">,</span> <span class="n">sense</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">maximize</span><span class="p">)</span></div>


<div class="viewcode-block" id="SolarDispatch.addReceiverStartupConstraints"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.SolarDispatch.SolarDispatch.addReceiverStartupConstraints">[docs]</a>    <span class="k">def</span> <span class="nf">addReceiverStartupConstraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to add solar startup constraints to the Pyomo Solar Model</span>
<span class="sd">        </span>
<span class="sd">        This method adds constraints pertaining to CSP power tower startup within the </span>
<span class="sd">        Pyomo Solar Dispatch class. Several nested functions are defined. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">rec_inventory_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; CSP energy inventory for startup is balanced &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">ursu</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">ursu0</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">Delta</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">xrsu</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">ursu</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">ursu</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">Delta</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">xrsu</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="k">def</span> <span class="nf">rec_inv_nonzero_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; CSP energy inventory is positive if starting up &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">ursu</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">Er</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">yrsu</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="k">def</span> <span class="nf">rec_startup_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; CSP resumes normal operation after startup or if previously operating &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">yr</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">ursu</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">/</span><span class="n">model</span><span class="o">.</span><span class="n">Er</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">yr0</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">yrsb0</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">yr</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">ursu</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">/</span><span class="n">model</span><span class="o">.</span><span class="n">Er</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">yr</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">yrsb</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">def</span> <span class="nf">rec_su_persist_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; CSP cannot startup if operating in previous timestep &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> 
                <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">yrsu</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">yr0</span> <span class="o">&lt;=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">yrsu</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span>  <span class="n">model</span><span class="o">.</span><span class="n">yr</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1</span>
        <span class="k">def</span> <span class="nf">ramp_limit_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; CSP must abide by ramp rate limits &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">xrsu</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">Qru</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">yrsu</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="k">def</span> <span class="nf">nontrivial_solar_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; CSP trivial power prevents startup &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">yrsu</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">Qin</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">/</span><span class="n">model</span><span class="o">.</span><span class="n">Qrl</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">rec_inventory_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">rec_inventory_rule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">rec_inv_nonzero_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">rec_inv_nonzero_rule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">rec_startup_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">rec_startup_rule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">rec_su_persist_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">rec_su_persist_rule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ramp_limit_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">ramp_limit_rule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">nontrivial_solar_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">nontrivial_solar_rule</span><span class="p">)</span></div>


<div class="viewcode-block" id="SolarDispatch.addReceiverSupplyAndDemandConstraints"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.SolarDispatch.SolarDispatch.addReceiverSupplyAndDemandConstraints">[docs]</a>    <span class="k">def</span> <span class="nf">addReceiverSupplyAndDemandConstraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to add CSP supply and demand constraints to the Pyomo Solar Model</span>
<span class="sd">        </span>
<span class="sd">        This method adds constraints pertaining to solar supply and demand energy</span>
<span class="sd">        constraints. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">rec_production_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; Upper bound on thermal energy produced by NP &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">xr</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">xrsu</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">Qrsd</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">yrsd</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">Qin</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="k">def</span> <span class="nf">rec_generation_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; Thermal energy production by NP only when operating &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">xr</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">Qin</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">yr</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="k">def</span> <span class="nf">min_generation_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; Lower bound on thermal energy produced by NP &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">xr</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">Qrl</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">yr</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="k">def</span> <span class="nf">rec_gen_persist_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; CSP not able to operate if no thermal power  &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">yr</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">Qin</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">/</span> <span class="n">model</span><span class="o">.</span><span class="n">Qrl</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">rec_production_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">rec_production_rule</span><span class="p">)</span> <span class="c1">#problem</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">rec_generation_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">rec_generation_rule</span><span class="p">)</span> <span class="c1"># problem</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">min_generation_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">min_generation_rule</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">rec_gen_persist_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">rec_gen_persist_rule</span><span class="p">)</span> </div>
        

<div class="viewcode-block" id="SolarDispatch.addReceiverNodeLogicConstraints"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.SolarDispatch.SolarDispatch.addReceiverNodeLogicConstraints">[docs]</a>    <span class="k">def</span> <span class="nf">addReceiverNodeLogicConstraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to add solar logic constraints to the Pyomo Solar Dispatch Model</span>
<span class="sd">        </span>
<span class="sd">        This method adds constraints pertaining to tracking binary variable</span>
<span class="sd">        logic for the CSP. Essentially, to make sure the correct modes</span>
<span class="sd">        are activated when they are allowed. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">rec_su_sb_persist_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; CSP startup and standby cannot coincide &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">yrsu</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">yrsb</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1</span>
        <span class="k">def</span> <span class="nf">rec_sb_persist_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; CSP standby and operation cannot coincide &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">yr</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">yrsb</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1</span>
        <span class="k">def</span> <span class="nf">rsb_persist_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; CSP standby must follow operating or another standby timestep &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">yrsb</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">yr0</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">yrsb0</span><span class="p">)</span> 
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">yrsb</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">yr</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">yrsb</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">def</span> <span class="nf">rec_su_pen_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; CSP cold startup penalty &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">yrsup</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">yrsu</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">yrsu0</span> 
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">yrsup</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">yrsu</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">yrsu</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">def</span> <span class="nf">rec_hs_pen_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; CSP hot startup penalty: if we went from standby to operating &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">yrhsp</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">yr</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">yrsb0</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">yrhsp</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">yr</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">yrsb</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">def</span> <span class="nf">rec_shutdown_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; CSP shutdown protocol &quot;&quot;&quot;</span>
            <span class="n">current_Delta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Delta</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
            <span class="c1"># structure of inequality is lb &lt;= model.param &lt;= ub with strict=False by default</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_ineq</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">current_Delta</span><span class="p">)</span> <span class="ow">and</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1">#not strict</span>
                <span class="k">return</span> <span class="mi">0</span> <span class="o">&gt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">yr0</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">yr</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span>  <span class="n">model</span><span class="o">.</span><span class="n">yrsb0</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">yrsb</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_ineq</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">current_Delta</span><span class="p">)</span> <span class="ow">and</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># not strict</span>
                <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">yrsd</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">yr</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">yr</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">yrsb</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">yrsb</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_ineq</span><span class="p">(</span><span class="n">current_Delta</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="ow">and</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">yrsd</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">yr0</span>  <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">yr</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">yrsb0</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">yrsb</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
            <span class="c1"># only case remaining: Delta[t]&lt;1, t&gt;1</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">yrsd</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">yr</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">yr</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">yrsb</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">yrsb</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">rec_su_sb_persist_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">rec_su_sb_persist_rule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">rec_sb_persist_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">rec_sb_persist_rule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">rsb_persist_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">rsb_persist_rule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">rec_su_pen_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">rec_su_pen_rule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">rec_hs_pen_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">rec_hs_pen_rule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">rec_shutdown_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">rec_shutdown_rule</span><span class="p">)</span></div>


<div class="viewcode-block" id="SolarDispatch.addCycleStartupConstraints"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.SolarDispatch.SolarDispatch.addCycleStartupConstraints">[docs]</a>    <span class="k">def</span> <span class="nf">addCycleStartupConstraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to add cycle startup constraints to the Pyomo General Model</span>
<span class="sd">        </span>
<span class="sd">        This method adds constraints pertaining to cycle startup within the Pyomo</span>
<span class="sd">        General Dispatch class. Several nested functions are defined. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dual</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">NuclearDispatch</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">addCycleStartupConstraints</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direct</span><span class="p">:</span>
                <span class="nb">super</span><span class="p">(</span><span class="n">IndirectNuclearDispatch</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">addCycleStartupConstraints</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">addCycleStartupConstraints</span><span class="p">()</span></div>


<div class="viewcode-block" id="SolarDispatch.addTESEnergyBalanceConstraints"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.SolarDispatch.SolarDispatch.addTESEnergyBalanceConstraints">[docs]</a>    <span class="k">def</span> <span class="nf">addTESEnergyBalanceConstraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to add TES constraints to the Pyomo Solar Model</span>
<span class="sd">        </span>
<span class="sd">        This method adds constraints pertaining to TES energy balance from charging</span>
<span class="sd">        with thermal power and discharging to the power cycle. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">tes_balance_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; Balance of energy to and from TES &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">s</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">s0</span> <span class="o">==</span> <span class="n">model</span><span class="o">.</span><span class="n">Delta</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">xr</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Qc</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">ycsu</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">Qb</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">ycsb</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">Qrsb</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">yrsb</span><span class="p">[</span><span class="n">t</span><span class="p">]))</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">s</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">s</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">model</span><span class="o">.</span><span class="n">Delta</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">xr</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Qc</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">ycsu</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">Qb</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">ycsb</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">Qrsb</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">yrsb</span><span class="p">[</span><span class="n">t</span><span class="p">]))</span>
        <span class="k">def</span> <span class="nf">tes_upper_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; Upper bound to TES charge state &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">s</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">Eu</span>
        <span class="k">def</span> <span class="nf">tes_start_up_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; Ensuring sufficient TES charge level to startup NP &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">s0</span> <span class="o">&gt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">Delta</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">delta_rs</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="p">(</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Qu</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">Qb</span><span class="p">)</span><span class="o">*</span><span class="p">(</span> <span class="o">-</span><span class="mi">3</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">yrsu</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">y0</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">ycsb0</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">ycsb</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="p">)</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">Qb</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">ycsb</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="p">)</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">s</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">Delta</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">delta_rs</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="p">(</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Qu</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">Qb</span><span class="p">)</span><span class="o">*</span><span class="p">(</span> <span class="o">-</span><span class="mi">3</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">yrsu</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">ycsb</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">ycsb</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="p">)</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">Qb</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">ycsb</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="p">)</span>
        <span class="k">def</span> <span class="nf">maintain_tes_rule</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; Final state of TES has to be less than or equal to start &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">s</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">num_periods</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">s0</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">tes_balance_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">tes_balance_rule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">tes_upper_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">tes_upper_rule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">tes_start_up_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">tes_start_up_rule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">maintain_tes_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">rule</span><span class="o">=</span><span class="n">maintain_tes_rule</span><span class="p">)</span></div>


<div class="viewcode-block" id="SolarDispatch.addPiecewiseLinearEfficiencyConstraints"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.SolarDispatch.SolarDispatch.addPiecewiseLinearEfficiencyConstraints">[docs]</a>    <span class="k">def</span> <span class="nf">addPiecewiseLinearEfficiencyConstraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to add efficiency constraints to the Pyomo Solar Model</span>
<span class="sd">        </span>
<span class="sd">        This method adds constraints pertaining to efficiency constraints defined</span>
<span class="sd">        as a piecewise linear approximation. Also referred to as Cycle supply and </span>
<span class="sd">        demand constraints. In the SolarDispatch, we add an extra balance of power</span>
<span class="sd">        with respect to energy storage and power produced from the CSP plant. </span>
<span class="sd">        </span>
<span class="sd">        TODO: This should be revisited when adding MED!!</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">NuclearDispatch</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">addPiecewiseLinearEfficiencyConstraints</span><span class="p">()</span>
        
        <span class="k">def</span> <span class="nf">grid_sun_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; Balance of power flow, i.e. sold vs purchased &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="p">(</span>
                    <span class="n">model</span><span class="o">.</span><span class="n">wdot_s</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">wdot_p</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model</span><span class="o">.</span><span class="n">etac</span><span class="p">[</span><span class="n">t</span><span class="p">])</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">wdot</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
                		<span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">Lr</span><span class="o">*</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">xr</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">xrsu</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">Qrl</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">yrsb</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
                		<span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">Lc</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> 
                        <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">Wh</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">yr</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">Wb</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">ycsb</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">Wht</span><span class="o">*</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">yrsb</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">yrsu</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>		<span class="c1">#Is Wrsb energy [kWh] or power [kW]?  [az] Wrsb = Wht in the math?</span>
                		<span class="o">-</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Ehs</span><span class="o">/</span><span class="n">model</span><span class="o">.</span><span class="n">Delta</span><span class="p">[</span><span class="n">t</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">yrsu</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">yrsb</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">yrsd</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
            <span class="p">)</span>
        
        <span class="c1"># additional constraints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">grid_sun_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">grid_sun_rule</span><span class="p">)</span></div>
        

<div class="viewcode-block" id="SolarDispatch.generate_constraints"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.SolarDispatch.SolarDispatch.generate_constraints">[docs]</a>    <span class="k">def</span> <span class="nf">generate_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skip_parent</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to add ALL constraints to the Pyomo Solar Model</span>
<span class="sd">        </span>
<span class="sd">        This method calls the previously defined constraint methods to instantiate</span>
<span class="sd">        them and add to the existing model. This method first calls the GeneralDispatch</span>
<span class="sd">        version to set PowerCycle constraints, then calls nuclear constraint methods</span>
<span class="sd">        to add them to the model. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dual</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">NuclearDispatch</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">generate_constraints</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addTESEnergyBalanceConstraints</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direct</span><span class="p">:</span>
                <span class="nb">super</span><span class="p">(</span><span class="n">IndirectNuclearDispatch</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">generate_constraints</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">generate_constraints</span><span class="p">()</span>
                
        <span class="bp">self</span><span class="o">.</span><span class="n">addReceiverStartupConstraints</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addReceiverSupplyAndDemandConstraints</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addReceiverNodeLogicConstraints</span><span class="p">()</span></div></div>


<span class="c1"># =============================================================================</span>
<span class="c1"># Dispatch Wrapper</span>
<span class="c1"># =============================================================================</span>

<div class="viewcode-block" id="SolarDispatchParamWrap"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.SolarDispatch.SolarDispatchParamWrap">[docs]</a><span class="k">class</span> <span class="nc">SolarDispatchParamWrap</span><span class="p">(</span><span class="n">IndirectNuclearDispatchParamWrap</span><span class="p">,</span> <span class="n">NuclearDispatchParamWrap</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The SolarDispatchParamWrap class is meant to be the staging area for the </span>
<span class="sd">    creation of Parameters ONLY for the SolarDispatch class. It communicates </span>
<span class="sd">    with the NE2 modules, receiving SSC and PySAM input dictionaries to calculate </span>
<span class="sd">    both static parameters used for every simulation segment AND initial conditions </span>
<span class="sd">    that can be updated.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="SolarDispatchParamWrap.__init__"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.SolarDispatch.SolarDispatchParamWrap.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Initializes the SolarDispatchParamWrap module</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">            unitRegistry (pint.registry)   : unique unit Pint unit registry</span>
<span class="sd">            SSC_dict (dict)                : dictionary of SSC inputs needed to run modules</span>
<span class="sd">            PySAM_dict (dict)              : dictionary of PySAM inputs + file names</span>
<span class="sd">            pyomo_horizon (int Quant)      : length of Pyomo simulation segment (hours)</span>
<span class="sd">            dispatch_time_step (int Quant) : length of each Pyomo time step (hours)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        
        <span class="c1"># check to see if we need to invoke the IndirectNuclear or bypass</span>
        <span class="k">if</span> <span class="s2">&quot;direct&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="c1"># doing indirect TES charging</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># bypassing, we are doing direct TES charging (or solar only)</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">IndirectNuclearDispatchParamWrap</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>



<div class="viewcode-block" id="SolarDispatchParamWrap.set_design"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.SolarDispatch.SolarDispatchParamWrap.set_design">[docs]</a>    <span class="k">def</span> <span class="nf">set_design</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skip_parent</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to calculate and save design point values of Plant operation</span>
<span class="sd">        </span>
<span class="sd">        This method extracts values and calculates for design point parameters </span>
<span class="sd">        of our Plant (e.g., nuclear thermal power output, power cycle efficiency,</span>
<span class="sd">        inlet and outlet temperatures, etc.). </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dual</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">NuclearDispatchParamWrap</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">set_design</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">q_rec_design</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SSC_dict</span><span class="p">[</span><span class="s2">&quot;P_ref&quot;</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">SSC_dict</span><span class="p">[</span><span class="s2">&quot;design_eff&quot;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">SSC_dict</span><span class="p">[</span><span class="s2">&quot;solarm&quot;</span><span class="p">]</span><span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">MW</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direct</span><span class="p">:</span>
                <span class="nb">super</span><span class="p">(</span><span class="n">IndirectNuclearDispatchParamWrap</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">set_design</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">set_design</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">q_rec_design</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SSC_dict</span><span class="p">[</span><span class="s2">&quot;q_dot_rec_des&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">MW</span>
        
        <span class="c1"># specific heat values at design point</span>
        <span class="n">T_htf</span>  <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T_htf_hot</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_htf_cold</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T_htf_avg</span> <span class="o">=</span> <span class="n">T_htf</span>
        <span class="n">cp_des</span> <span class="o">=</span> <span class="n">SSCHelperMethods</span><span class="o">.</span><span class="n">get_cp_htf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="p">,</span> <span class="n">T_htf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SSC_dict</span><span class="p">[</span><span class="s1">&#39;rec_htf&#39;</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">cp_des</span> <span class="o">=</span> <span class="n">cp_des</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;J/g/kelvin&#39;</span><span class="p">)</span>   
        
        <span class="n">dm_rec_des</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_rec_design</span> <span class="o">/</span> <span class="p">(</span><span class="n">cp_des</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T_htf_hot</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_htf_cold</span><span class="p">)</span> <span class="p">)</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">dm_rec_design</span> <span class="o">=</span> <span class="n">dm_rec_des</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kg/s&#39;</span><span class="p">)</span> 
    
        <span class="c1"># PC mass flow rate</span>
        <span class="n">dm_des</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_pb_design</span> <span class="o">/</span> <span class="p">(</span><span class="n">cp_des</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T_htf_hot</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_htf_cold</span><span class="p">)</span> <span class="p">)</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">dm_pb_design</span> <span class="o">=</span> <span class="n">dm_des</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kg/s&#39;</span><span class="p">)</span>                               <span class="c1"># power block design mass flow rate</span>
        
        <span class="c1"># TES design point</span>
        <span class="n">e_tes_design</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_pb_design</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">SSC_dict</span><span class="p">[</span><span class="s1">&#39;tshours&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">hr</span>  
        <span class="n">m_tes_des</span> <span class="o">=</span> <span class="n">e_tes_design</span> <span class="o">/</span> <span class="n">cp_des</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T_htf_hot</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_htf_cold</span><span class="p">)</span>     
        <span class="bp">self</span><span class="o">.</span><span class="n">e_tes_design</span> <span class="o">=</span> <span class="n">e_tes_design</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kWh&#39;</span><span class="p">)</span> <span class="c1"># TES storage capacity (kWht)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_tes_design</span> <span class="o">=</span> <span class="n">m_tes_des</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kg&#39;</span><span class="p">)</span>     <span class="c1"># TES active storage mass (kg)</span></div>


<div class="viewcode-block" id="SolarDispatchParamWrap.set_fixed_cost_parameters"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.SolarDispatch.SolarDispatchParamWrap.set_fixed_cost_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">set_fixed_cost_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to set fixed costs of the Plant</span>
<span class="sd">        </span>
<span class="sd">        This method calculates some fixed costs for the Plant operations, startup,</span>
<span class="sd">        standby, etc. </span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">            param_dict (dict) : dictionary of Pyomo dispatch parameters</span>
<span class="sd">        Outputs:</span>
<span class="sd">            param_dict (dict) : updated dictionary of Pyomo dispatch parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># grabbing unit registry set up in GeneralDispatch</span>
        <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span>
    
        <span class="c1"># set up costs from parent class</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dual</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">NuclearDispatchParamWrap</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">set_fixed_cost_parameters</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direct</span><span class="p">:</span>
                <span class="nb">super</span><span class="p">(</span><span class="n">IndirectNuclearDispatchParamWrap</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">set_fixed_cost_parameters</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">set_fixed_cost_parameters</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span>
        
        <span class="c1"># TODO: old values from LORE files</span>
        <span class="n">C_rec</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PySAM_dict</span><span class="p">[</span><span class="s1">&#39;rec_op_cost&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">USD</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">MWh</span> <span class="c1">#Q_ratio * 0.002  * u.USD/u.kWh        </span>
        <span class="n">C_rsu</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PySAM_dict</span><span class="p">[</span><span class="s1">&#39;rec_cold_su&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">USD</span>
        <span class="n">C_rhsp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PySAM_dict</span><span class="p">[</span><span class="s1">&#39;rec_hot_su&#39;</span><span class="p">]</span>  <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">USD</span>

        <span class="c1">### Cost Parameters ###</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;Crec&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">C_rec</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;USD/kWh&#39;</span><span class="p">)</span>  <span class="c1">#C^{rec}: Operating cost of heliostat field and receiver [\$/kWt$\cdot$h]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;Crsu&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">C_rsu</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;USD&#39;</span><span class="p">)</span>      <span class="c1">#C^{rsu}: Penalty for receiver cold start-up [\$/start]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;Crhsp&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">C_rhsp</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;USD&#39;</span><span class="p">)</span>     <span class="c1">#C^{rhsp}: Penalty for receiver hot start-up [\$/start]</span>

        <span class="k">return</span> <span class="n">param_dict</span></div>


<div class="viewcode-block" id="SolarDispatchParamWrap.set_solar_parameters"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.SolarDispatch.SolarDispatchParamWrap.set_solar_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">set_solar_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to set parameters specific to the Solar Plant for Dispatch optimization</span>
<span class="sd">        </span>
<span class="sd">        This method calculates some parameters specific to the SolarTES plant</span>
<span class="sd">        which are meant to be fixed throughout the simulation. </span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">            param_dict (dict) : dictionary of Pyomo dispatch parameters</span>
<span class="sd">        Outputs:</span>
<span class="sd">            param_dict (dict) : updated dictionary of Pyomo dispatch parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># grabbing unit registry set up in GeneralDispatch</span>
        <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span> 
        
        <span class="c1"># pumpimg parasitics for receiver</span>
        <span class="n">wdot</span> <span class="o">=</span> <span class="n">SSCHelperMethods</span><span class="o">.</span><span class="n">estimate_receiver_pumping_parasitic</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_htf_avg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dm_rec_design</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SSC_dict</span><span class="p">)</span>
        <span class="n">wdot</span> <span class="o">=</span> <span class="n">wdot</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;MW&#39;</span><span class="p">)</span>  
        
        <span class="c1"># various pre-parameters and other inputs</span>
        <span class="n">N_hel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SSC_dict</span><span class="p">[</span><span class="s1">&#39;N_hel&#39;</span><span class="p">]</span>
        
        <span class="n">tower_piping_ht_loss</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PySAM_dict</span><span class="p">[</span><span class="s1">&#39;tower_piping_ht_loss&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">kW</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">MW</span>   <span class="c1"># (from LORE) Tower piping heat trace full-load parasitic load (kWe/MWt) </span>
        <span class="n">q_rec_standby_fraction</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PySAM_dict</span><span class="p">[</span><span class="s1">&#39;q_rec_standby_frac&#39;</span><span class="p">]</span>        
        <span class="n">q_rec_shutdown_fraction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PySAM_dict</span><span class="p">[</span><span class="s1">&#39;q_rec_shutdown_frac&#39;</span><span class="p">]</span>   
        <span class="n">Drsu</span>                    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SSC_dict</span><span class="p">[</span><span class="s1">&#39;rec_su_delay&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">hr</span>
        <span class="n">heliostat_SU_energy</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SSC_dict</span><span class="p">[</span><span class="s1">&#39;p_start&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">kWh</span>
        <span class="n">heliostat_track_energy</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SSC_dict</span><span class="p">[</span><span class="s1">&#39;p_track&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">kW</span>
        <span class="n">receiver_SU_ratio</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SSC_dict</span><span class="p">[</span><span class="s1">&#39;rec_qf_delay&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">MWh</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">MW</span> 
        <span class="n">TES_load_hrs</span>            <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SSC_dict</span><span class="p">[</span><span class="s1">&#39;tshours&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">hr</span>
        <span class="n">min_massflow_td_frac</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SSC_dict</span><span class="p">[</span><span class="s1">&#39;f_rec_min&#39;</span><span class="p">]</span>
        
        <span class="c1"># second-to-last step before setting param_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deltal</span> <span class="o">=</span> <span class="n">Drsu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ehs</span>    <span class="o">=</span> <span class="n">N_hel</span> <span class="o">*</span> <span class="n">heliostat_SU_energy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Er</span>     <span class="o">=</span> <span class="n">receiver_SU_ratio</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_rec_design</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_rec_design</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">125</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">MWh</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">Eu</span>     <span class="o">=</span> <span class="n">TES_load_hrs</span>      <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_pb_design</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Lr</span>     <span class="o">=</span> <span class="n">wdot</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_rec_design</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_rec_design</span><span class="o">.</span><span class="n">m</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">W</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">W</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Qrl</span>    <span class="o">=</span> <span class="n">min_massflow_td_frac</span>    <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_rec_design</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">Qrsb</span>   <span class="o">=</span> <span class="n">q_rec_standby_fraction</span>  <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_rec_design</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">Qrsd</span>   <span class="o">=</span> <span class="n">q_rec_shutdown_fraction</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_rec_design</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Qru</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Er</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltal</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">Wh</span>     <span class="o">=</span> <span class="n">N_hel</span> <span class="o">*</span> <span class="n">heliostat_track_energy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Wht</span>    <span class="o">=</span> <span class="n">tower_piping_ht_loss</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_rec_design</span> 
        
        <span class="c1">### CSP Field and Receiver Parameters ###</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;deltal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltal</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;hr&#39;</span><span class="p">)</span>    <span class="c1">#\delta^l: Minimum time to start the receiver [hr]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;Ehs&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ehs</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kWh&#39;</span><span class="p">)</span>      <span class="c1">#E^{hs}: Heliostat field startup or shut down parasitic loss [kWe$\cdot$h]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;Er&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Er</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kWh&#39;</span><span class="p">)</span>       <span class="c1">#E^r: Required energy expended to start receiver [kWt$\cdot$h]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;Eu&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Eu</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kWh&#39;</span><span class="p">)</span>       <span class="c1">#E^u: Thermal energy storage capacity [kWt$\cdot$h]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;Lr&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Lr</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>          <span class="c1">#L^r: Receiver pumping power per unit power produced [kWe/kWt]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;Qrl&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Qrl</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kW&#39;</span><span class="p">)</span>      <span class="c1">#Q^{rl}: Minimum operational thermal power delivered by receiver [kWt$\cdot$h]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;Qrsb&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Qrsb</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kW&#39;</span><span class="p">)</span>     <span class="c1">#Q^{rsb}: Required thermal power for receiver standby [kWt$\cdot$h]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;Qrsd&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Qrsd</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kW&#39;</span><span class="p">)</span>     <span class="c1">#Q^{rsd}: Required thermal power for receiver shut down [kWt$\cdot$h] </span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;Qru&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Qru</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kW&#39;</span><span class="p">)</span>       <span class="c1">#Q^{ru}: Allowable power per period for receiver start-up [kWt$\cdot$h]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;Wh&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wh</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kW&#39;</span><span class="p">)</span>        <span class="c1">#W^h: Heliostat field tracking parasitic loss [kWe]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;Wht&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wht</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kW&#39;</span><span class="p">)</span>      <span class="c1">#W^{ht}: Tower piping heat trace parasitic loss [kWe]</span>
        
        <span class="k">return</span> <span class="n">param_dict</span></div>


<div class="viewcode-block" id="SolarDispatchParamWrap.set_time_series_solar_parameters"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.SolarDispatch.SolarDispatchParamWrap.set_time_series_solar_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">set_time_series_solar_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param_dict</span><span class="p">,</span> <span class="n">updated_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to set fixed costs of the Plant for Dispatch optimization</span>
<span class="sd">        </span>
<span class="sd">        This method calculates some time series parameters for the Plant operations, startup,</span>
<span class="sd">        standby, etc. These are NOT meant to be fixed, but updated at the beginning</span>
<span class="sd">        of every segment using the latest SSC outputs or to extract the next relevant</span>
<span class="sd">        segment of pricing arrays, efficiencies, etc. </span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">            param_dict (dict)   : dictionary of Pyomo dispatch parameters</span>
<span class="sd">            updated_dict (dict) : dictionary with updated SSC initial conditions from previous run  </span>
<span class="sd">        Outputs:</span>
<span class="sd">            param_dict (dict) : updated dictionary of Pyomo dispatch parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#MAKE SURE TO CALL THIS METHOD AFTER THE NUCLEAR PARAMETERS </span>
        <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span>
        
        <span class="c1"># differentiating between first and updated runs</span>
        <span class="k">if</span> <span class="n">updated_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_Plant</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SSC_dict</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first_run</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_Plant</span> <span class="o">=</span> <span class="n">updated_dict</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first_run</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="c1"># thermal power and startup params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Drsu</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_Plant</span><span class="p">[</span><span class="s1">&#39;rec_su_delay&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">hr</span> <span class="c1"># Minimum time to start the CSP plant (hr)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Qin</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_Plant</span><span class="p">[</span><span class="s1">&#39;Q_thermal&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">MW</span>    <span class="c1"># value here taken from a previous Plant-SSC run</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Qin</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;Delta&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Qin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_Plant</span><span class="p">[</span><span class="s1">&#39;Q_thermal&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_Plant</span><span class="p">[</span><span class="s1">&#39;Q_thermal&#39;</span><span class="p">]]</span> <span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">MW</span>
        
        <span class="c1"># instantiating arrays</span>
        <span class="n">n</span>  <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Delta</span><span class="p">)</span>
        <span class="n">delta_rs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        
        <span class="c1"># loop to set startup nuclear params (probably won&#39;t need, keeping it for unit testing?)</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">Ein</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Qin</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Delta</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
            <span class="n">E_compare</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Er</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1.</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">kWh</span><span class="p">,</span> <span class="n">Ein</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kWh&#39;</span><span class="p">)))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">delta_rs</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span> <span class="n">E_compare</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Drsu</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Delta</span><span class="p">[</span><span class="n">t</span><span class="p">]))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">delta_rs</span>   <span class="o">=</span> <span class="n">delta_rs</span>

        <span class="c1">### Time series CSP Parameters ###</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;delta_rs&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta_rs</span>          <span class="c1">#\delta^{rs}_{t}: Estimated fraction of period $t$ required for receiver start-up [-]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;Qin&#39;</span><span class="p">]</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Qin</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kW&#39;</span><span class="p">)</span>      <span class="c1">#Q^{in}_{t}: Available thermal power generated by the CSP heliostat field in period $t$ [kWt]</span>
        
        <span class="k">return</span> <span class="n">param_dict</span></div>


<div class="viewcode-block" id="SolarDispatchParamWrap.set_initial_state"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.SolarDispatch.SolarDispatchParamWrap.set_initial_state">[docs]</a>    <span class="k">def</span> <span class="nf">set_initial_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param_dict</span><span class="p">,</span> <span class="n">updated_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plant</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">npts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skip_parent</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to set the initial state of the Plant before Dispatch optimization</span>
<span class="sd">        </span>
<span class="sd">        This method uses SSC data to set the initial state of the Plant before Dispatch</span>
<span class="sd">        optimization in Pyomo. This method is called in two ways: once before starting </span>
<span class="sd">        the simulation loop, in which case it only uses values from the SSC_dict portion</span>
<span class="sd">        of the given JSON script. The method is also called within the simulation loop</span>
<span class="sd">        to update the initial state parameters based on the ending conditions of the </span>
<span class="sd">        previous simulation segment (provided by SSC). </span>
<span class="sd">        </span>
<span class="sd">        TODO: can we just input another dictionary instead of passing the full Plant?</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">            param_dict (dict)    : dictionary of Pyomo dispatch parameters</span>
<span class="sd">            updated_dict (dict)  : dictionary with updated SSC initial conditions from previous run</span>
<span class="sd">            plant (obj)          : the full PySAM Plant object. </span>
<span class="sd">            npts (int)           : length of the SSC horizon</span>
<span class="sd">        Outputs:</span>
<span class="sd">            param_dict (dict) : updated dictionary of Pyomo dispatch parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span>
        
        <span class="c1"># First filling out initial states from GeneralDispatcher</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dual</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">NuclearDispatchParamWrap</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">set_initial_state</span><span class="p">(</span><span class="n">param_dict</span><span class="p">,</span> <span class="n">updated_dict</span><span class="p">,</span> <span class="n">plant</span><span class="p">,</span> <span class="n">npts</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direct</span><span class="p">:</span>
                <span class="nb">super</span><span class="p">(</span><span class="n">IndirectNuclearDispatchParamWrap</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">set_initial_state</span><span class="p">(</span><span class="n">param_dict</span><span class="p">,</span> <span class="n">updated_dict</span><span class="p">,</span> <span class="n">plant</span><span class="p">,</span> <span class="n">npts</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">set_initial_state</span><span class="p">(</span><span class="n">param_dict</span><span class="p">,</span> <span class="n">updated_dict</span><span class="p">,</span> <span class="n">plant</span><span class="p">,</span> <span class="n">npts</span> <span class="p">)</span>
                
        <span class="k">if</span> <span class="n">updated_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_Plant</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SSC_dict</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first_run</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_Plant</span> <span class="o">=</span> <span class="n">updated_dict</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first_run</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="c1"># TES masses, temperatures, specific heat</span>
        <span class="n">m_hot</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_tes_design</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_Plant</span><span class="p">[</span><span class="s1">&#39;csp.pt.tes.init_hot_htf_percent&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span>        <span class="c1"># Available active mass in hot tank</span>
        <span class="n">T_tes_hot_init</span>  <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_Plant</span><span class="p">[</span><span class="s1">&#39;T_tank_hot_init&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">celsius</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;degK&#39;</span><span class="p">)</span>
        <span class="n">T_tes_init</span>  <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">T_tes_hot_init</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_htf_cold</span><span class="p">)</span>
        <span class="n">cp_tes_init</span> <span class="o">=</span> <span class="n">SSCHelperMethods</span><span class="o">.</span><span class="n">get_cp_htf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="p">,</span> <span class="n">T_tes_init</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SSC_dict</span><span class="p">[</span><span class="s1">&#39;rec_htf&#39;</span><span class="p">]</span> <span class="p">)</span>
        
        <span class="c1"># important parameters</span>
        <span class="n">s_current</span>          <span class="o">=</span> <span class="n">m_hot</span> <span class="o">*</span> <span class="n">cp_tes_init</span> <span class="o">*</span> <span class="p">(</span><span class="n">T_tes_hot_init</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_htf_cold</span><span class="p">)</span> <span class="c1"># TES capacity</span>
        <span class="n">s0</span>                 <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Eu</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kWh&#39;</span><span class="p">),</span> <span class="n">s_current</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kWh&#39;</span><span class="p">)</span>  <span class="p">)</span>
        <span class="n">yr0</span>                <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_Plant</span><span class="p">[</span><span class="s1">&#39;rec_op_mode_initial&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">yrsb0</span>              <span class="o">=</span> <span class="kc">False</span>   <span class="c1"># We don&#39;t have standby mode for either Nuclear or CSP</span>
        <span class="n">yrsu0</span>              <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_Plant</span><span class="p">[</span><span class="s1">&#39;rec_op_mode_initial&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">t_rec</span>              <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_Plant</span><span class="p">[</span><span class="s1">&#39;rec_startup_time_remain_init&#39;</span><span class="p">]</span>
        <span class="n">t_rec_suinitremain</span> <span class="o">=</span> <span class="n">t_rec</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span> <span class="n">t_rec</span> <span class="p">)</span> <span class="k">else</span> <span class="mf">0.0</span>
        <span class="n">e_rec</span>              <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_Plant</span><span class="p">[</span><span class="s1">&#39;rec_startup_energy_remain_init&#39;</span><span class="p">]</span>
        <span class="n">e_rec_suinitremain</span> <span class="o">=</span> <span class="n">e_rec</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span> <span class="n">e_rec</span> <span class="p">)</span> <span class="k">else</span> <span class="mf">0.0</span>
        <span class="n">rec_accum_time</span>     <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">hr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Drsu</span> <span class="o">-</span> <span class="n">t_rec_suinitremain</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">hr</span> <span class="p">)</span>
        <span class="n">rec_accum_energy</span>   <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">Wh</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Er</span>   <span class="o">-</span> <span class="n">e_rec_suinitremain</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">Wh</span> <span class="p">)</span>

        <span class="c1"># defining parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s0</span>    <span class="o">=</span> <span class="n">s0</span>              <span class="c1">#s_0: Initial TES reserve quantity  [kWt$\cdot$h]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yr0</span>   <span class="o">=</span> <span class="n">yr0</span>             <span class="c1">#y^r_0: 1 if receiver is generating ``usable&#39;&#39; thermal power initially, 0 otherwise  [az] this is new.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yrsb0</span> <span class="o">=</span> <span class="n">yrsb0</span>           <span class="c1">#y^{rsb}_0: 1 if receiver is in standby mode initially, 0 otherwise [az] this is new.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yrsu0</span> <span class="o">=</span> <span class="n">yrsu0</span>           <span class="c1">#y^{rsu}_0: 1 if receiver is in starting up initially, 0 otherwise    [az] this is new.</span>
        
        <span class="c1"># Initial nuclear startup energy inventory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ursu0</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">rec_accum_energy</span><span class="p">,</span> <span class="n">rec_accum_time</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Qru</span><span class="p">)</span>  <span class="c1"># Note, SS receiver model in ssc assumes full available power is used for startup (even if, time requirement is binding)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ursu0</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1.e-6</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Er</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ursu0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Er</span>

        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;s0&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s0</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kWh&#39;</span><span class="p">)</span>    <span class="c1">#s_0: Initial TES reserve quantity  [kWt$\cdot$h]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;ursu0&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ursu0</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kWh&#39;</span><span class="p">)</span> <span class="c1">#u^{rsu}_0: Initial receiver start-up energy inventory [kWt$\cdot$h]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;yr0&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yr0</span>             <span class="c1">#y^r_0: 1 if receiver is generating ``usable&#39;&#39; thermal power initially, 0 otherwise  [az] this is new.</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;yrsb0&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yrsb0</span>           <span class="c1">#y^{rsb}_0: 1 if receiver is in standby mode initially, 0 otherwise [az] this is new.</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;yrsu0&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yrsu0</span>           <span class="c1">#y^{rsu}_0: 1 if receiver is in starting up initially, 0 otherwise    [az] this is new.</span>
        
        <span class="k">return</span> <span class="n">param_dict</span></div></div>


<div class="viewcode-block" id="SolarDispatchOutputs"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.SolarDispatch.SolarDispatchOutputs">[docs]</a><span class="k">class</span> <span class="nc">SolarDispatchOutputs</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The SolarDispatchOutputs class is meant to handle outputs from a given,</span>
<span class="sd">    solved Pyomo Dispatch model. It returns desired outputs in appropriate formats</span>
<span class="sd">    and syntaxes for PostProcessing and linking simulation segments between Pyomo</span>
<span class="sd">    and SSC calls. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="SolarDispatchOutputs.get_dispatch_targets_from_Pyomo"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.SolarDispatch.SolarDispatchOutputs.get_dispatch_targets_from_Pyomo">[docs]</a>    <span class="k">def</span> <span class="nf">get_dispatch_targets_from_Pyomo</span><span class="p">(</span><span class="n">dispatch_model</span><span class="p">,</span> <span class="n">horizon</span><span class="p">,</span> <span class="n">N_full</span><span class="p">,</span> <span class="n">run_loop</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to set fixed costs of the Plant</span>
<span class="sd">        </span>
<span class="sd">        This method parses through the solved Pyomo model for Dispatch optimization</span>
<span class="sd">        and extracts results that are used as Dispatch Targets in the *SAME* simulation</span>
<span class="sd">        segment but in SSC rather than Pyomo. If we&#39;re not running a loop, we can</span>
<span class="sd">        still update SSC only I guess this happens once for whatever Pyomo horizon</span>
<span class="sd">        is defined (this might not be a feature we keep long-term, perhaps only for</span>
<span class="sd">                    debugging). </span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">            dispatch_model (Pyomo model) : solved Pyomo Dispatch model (ConcreteModel)</span>
<span class="sd">            horizon (float Quant)        : length of time of horizon, whether SSC or Pyomo (in hours)</span>
<span class="sd">            N_full (int)                 : length of full simulation time (in hours, no Quant)</span>
<span class="sd">            run_loop (bool)              : flag to determine if simulation is segmented</span>
<span class="sd">        Outputs:</span>
<span class="sd">            disp_targs (dict) : dictionary of dispatch target arrays for use in SSC </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">dm</span> <span class="o">=</span> <span class="n">dispatch_model</span>
        
        <span class="c1"># range of pyomo and SSC horizon times</span>
        <span class="n">t_pyomo</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span>
        <span class="n">f_ind</span>   <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="n">horizon</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;hr&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">m</span> <span class="p">)</span> <span class="c1"># index in hours of final horizon (e.g. 24)</span>
        <span class="n">t_horizon</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">f_ind</span><span class="p">)</span>
        
        <span class="c1"># if we&#39;re not running a loop, define a list of 0s to pad the output so it matches full array size</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">run_loop</span><span class="p">:</span>
            <span class="n">N_leftover</span> <span class="o">=</span> <span class="n">N_full</span> <span class="o">-</span> <span class="n">f_ind</span>
            <span class="n">empty_array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">N_leftover</span>
        
        <span class="c1">#----Receiver Binary Outputs----</span>
        <span class="n">yr</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pe</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">dm</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">yr</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>   <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_pyomo</span><span class="p">])</span>
        <span class="n">yrsu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pe</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">dm</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">yrsu</span><span class="p">[</span><span class="n">t</span><span class="p">])</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_pyomo</span><span class="p">])</span>
        <span class="n">yrsb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pe</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">dm</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">yrsb</span><span class="p">[</span><span class="n">t</span><span class="p">])</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_pyomo</span><span class="p">])</span>
        
        <span class="c1">#----Cycle Binary Outputs----</span>
        <span class="n">y</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pe</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">dm</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_pyomo</span><span class="p">])</span>
        <span class="n">ycsu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pe</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">dm</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ycsu</span><span class="p">[</span><span class="n">t</span><span class="p">])</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_pyomo</span><span class="p">])</span>
        <span class="n">ycsb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pe</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">dm</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ycsb</span><span class="p">[</span><span class="n">t</span><span class="p">])</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_pyomo</span><span class="p">])</span>
    
        <span class="c1">#----Cycle Thermal Power Utilization----</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pe</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">dm</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>   <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_pyomo</span><span class="p">])</span><span class="o">/</span><span class="mf">1000.</span> <span class="c1"># from kWt -&gt; MWt</span>
        
        <span class="c1">#----Thermal Capacity for Cycle Startup and Operation----</span>
        <span class="n">Qc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pe</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">dm</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Qc</span><span class="p">[</span><span class="n">t</span><span class="p">])</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_pyomo</span><span class="p">])</span><span class="o">/</span><span class="mf">1000.</span> <span class="c1"># from kWt -&gt; MWt</span>
        <span class="n">Qu</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Qu</span><span class="o">.</span><span class="n">value</span><span class="o">/</span><span class="mf">1000.</span> <span class="c1"># from kWt -&gt; MWt</span>
    
        <span class="c1"># dispatch target -- nuclear startup/standby binaries</span>
        <span class="n">is_rec_su_allowed_in</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="k">if</span> <span class="p">(</span><span class="n">yr</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">yrsu</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">yrsb</span><span class="p">[</span><span class="n">t</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">0.001</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_horizon</span><span class="p">]</span>  <span class="c1"># Receiver on, startup, or standby</span>
        <span class="n">is_rec_sb_allowed_in</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="k">if</span> <span class="n">yrsb</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.001</span>                     <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_horizon</span><span class="p">]</span>  <span class="c1"># Receiver standby</span>
        
        <span class="c1"># dispatch target -- cycle startup/standby binaries</span>
        <span class="n">is_pc_su_allowed_in</span>  <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="k">if</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">ycsu</span><span class="p">[</span><span class="n">t</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">0.001</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_horizon</span><span class="p">]</span>  <span class="c1"># Cycle on or startup</span>
        <span class="n">is_pc_sb_allowed_in</span>  <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="k">if</span> <span class="n">ycsb</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.001</span>          <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_horizon</span><span class="p">]</span>  <span class="c1"># Cycle standby</span>
    
        <span class="c1"># dispatch target -- cycle thermal inputs and capacities</span>
        <span class="n">q_pc_target_su_in</span>    <span class="o">=</span> <span class="p">[</span><span class="n">Qc</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="k">if</span> <span class="n">ycsu</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.001</span> <span class="k">else</span> <span class="mf">0.0</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_horizon</span><span class="p">]</span>
        <span class="n">q_pc_target_on_in</span>    <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>                              <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_horizon</span><span class="p">]</span>
        <span class="n">q_pc_max_in</span>          <span class="o">=</span> <span class="p">[</span><span class="n">Qu</span>                                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_horizon</span><span class="p">]</span>
        
        <span class="c1"># empty dictionary for output</span>
        <span class="n">disp_targs</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="c1"># if we&#39;re running full simulation in steps, save SSC horizon portion of Pyomo horizon results</span>
        <span class="k">if</span> <span class="n">run_loop</span><span class="p">:</span>
            <span class="n">disp_targs</span><span class="p">[</span><span class="s1">&#39;is_rec_su_allowed_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">is_rec_su_allowed_in</span> 
            <span class="n">disp_targs</span><span class="p">[</span><span class="s1">&#39;is_rec_sb_allowed_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">is_rec_sb_allowed_in</span>
            <span class="n">disp_targs</span><span class="p">[</span><span class="s1">&#39;is_pc_su_allowed_in&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">is_pc_su_allowed_in</span> 
            <span class="n">disp_targs</span><span class="p">[</span><span class="s1">&#39;is_pc_sb_allowed_in&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">is_pc_sb_allowed_in</span>  
            <span class="n">disp_targs</span><span class="p">[</span><span class="s1">&#39;q_pc_target_su_in&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="n">q_pc_target_su_in</span>  
            <span class="n">disp_targs</span><span class="p">[</span><span class="s1">&#39;q_pc_target_on_in&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="n">q_pc_target_on_in</span>
            <span class="n">disp_targs</span><span class="p">[</span><span class="s1">&#39;q_pc_max_in&#39;</span><span class="p">]</span>          <span class="o">=</span> <span class="n">q_pc_max_in</span>
        <span class="c1"># if we&#39;re running full simulation all at once, need arrays to match size of full sim</span>
        <span class="c1"># TODO: is this a feature we want in the long term? Or just for debugging the first Pyomo call?</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">disp_targs</span><span class="p">[</span><span class="s1">&#39;is_rec_su_allowed_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span> <span class="p">[</span><span class="n">is_rec_su_allowed_in</span> <span class="p">,</span> <span class="n">empty_array</span><span class="p">]</span> <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">disp_targs</span><span class="p">[</span><span class="s1">&#39;is_rec_sb_allowed_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span> <span class="p">[</span><span class="n">is_rec_sb_allowed_in</span> <span class="p">,</span> <span class="n">empty_array</span><span class="p">]</span> <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">disp_targs</span><span class="p">[</span><span class="s1">&#39;is_pc_su_allowed_in&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span> <span class="p">[</span><span class="n">is_pc_su_allowed_in</span>  <span class="p">,</span> <span class="n">empty_array</span><span class="p">]</span> <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">disp_targs</span><span class="p">[</span><span class="s1">&#39;is_pc_sb_allowed_in&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span> <span class="p">[</span><span class="n">is_pc_sb_allowed_in</span>  <span class="p">,</span> <span class="n">empty_array</span><span class="p">]</span> <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">disp_targs</span><span class="p">[</span><span class="s1">&#39;q_pc_target_su_in&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span> <span class="p">[</span><span class="n">q_pc_target_su_in</span>    <span class="p">,</span> <span class="n">empty_array</span><span class="p">]</span> <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">disp_targs</span><span class="p">[</span><span class="s1">&#39;q_pc_target_on_in&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span> <span class="p">[</span><span class="n">q_pc_target_on_in</span>    <span class="p">,</span> <span class="n">empty_array</span><span class="p">]</span> <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">disp_targs</span><span class="p">[</span><span class="s1">&#39;q_pc_max_in&#39;</span><span class="p">]</span>          <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span> <span class="p">[</span><span class="n">q_pc_max_in</span>          <span class="p">,</span> <span class="n">empty_array</span><span class="p">]</span> <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            
        <span class="k">return</span> <span class="n">disp_targs</span></div></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">NE-2 Simulations  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">simulations.dispatch.SolarDispatch</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2021, Gabriel J. Soto, Una Baker, Grace Stanke, Ben Lindley, Mike Wagner.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.2.0.
    </div>
  </body>
</html>