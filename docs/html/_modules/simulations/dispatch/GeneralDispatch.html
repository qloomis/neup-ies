

<!doctype html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>simulations.dispatch.GeneralDispatch &#8212; NE-2 Simulations  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/bizstyle.css" />
    
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">NE-2 Simulations  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">simulations.dispatch.GeneralDispatch</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for simulations.dispatch.GeneralDispatch</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Pyomo real-time dispatch model</span>


<span class="sd">Model authors:</span>
<span class="sd">* Mike Wagner - UW-Madison</span>
<span class="sd">* Bill Hamilton - NREL </span>
<span class="sd">* John Cox - Colorado School of Mines</span>
<span class="sd">* Alex Zolan - NREL</span>

<span class="sd">Pyomo code by Alex Zolan</span>
<span class="sd">Modified by Gabriel Soto</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">pyomo.environ</span> <span class="k">as</span> <span class="nn">pe</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">util.FileMethods</span> <span class="kn">import</span> <span class="n">FileMethods</span>
<span class="kn">from</span> <span class="nn">util.SSCHelperMethods</span> <span class="kn">import</span> <span class="n">SSCHelperMethods</span>
<span class="kn">from</span> <span class="nn">pyomo.environ</span> <span class="kn">import</span> <span class="n">value</span>
<span class="kn">from</span> <span class="nn">pyomo.environ</span> <span class="kn">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">u_pyomo</span>
<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">u_pyomo</span><span class="p">,</span><span class="s1">&#39;USD&#39;</span><span class="p">):</span>
    <span class="n">u_pyomo</span><span class="o">.</span><span class="n">load_definitions_from_strings</span><span class="p">([</span><span class="s1">&#39;USD = [currency]&#39;</span><span class="p">])</span>
<span class="kn">from</span> <span class="nn">pyomo.util.check_units</span> <span class="kn">import</span> <span class="n">assert_units_consistent</span><span class="p">,</span> <span class="n">assert_units_equivalent</span><span class="p">,</span> <span class="n">check_units_equivalent</span>
<span class="kn">from</span> <span class="nn">pyomo.util.infeasible</span> <span class="kn">import</span> <span class="n">log_infeasible_constraints</span><span class="p">,</span> <span class="n">log_infeasible_bounds</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>


<div class="viewcode-block" id="GeneralDispatch"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.GeneralDispatch.GeneralDispatch">[docs]</a><span class="k">class</span> <span class="nc">GeneralDispatch</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The GeneralDispatch class is meant to set up and run Dispatch</span>
<span class="sd">    optimization as a mixed integer linear program problem using Pyomo.</span>
<span class="sd">    It creates a ConcreteModel in Pyomo with Parameters, Variables,</span>
<span class="sd">    Objectives, and Constraints. The ConcreteModel can then be solved. </span>
<span class="sd">    </span>
<span class="sd">    This is the base/parent class and should not be run by itself. </span>
<span class="sd">    Essentially, this sets Pyomo with PowerCycle-specific parameters,</span>
<span class="sd">    variables, objectives, and constraints. Derived classes can then</span>
<span class="sd">    be instantiated to add more specific constraints and overload the</span>
<span class="sd">    objective function. </span>
<span class="sd">    </span>
<span class="sd">    TODO: can we convert this to an abstract class in Python?</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="GeneralDispatch.__init__"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.GeneralDispatch.GeneralDispatch.__init__">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unitRegistry</span><span class="p">,</span> <span class="n">dual</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">direct</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Initializes the GeneralDispatch module</span>
<span class="sd">        </span>
<span class="sd">        The instantiation of this class receives a parameter dictionary from</span>
<span class="sd">        the NE2 module (created using a DispatchWrapper class in this file but</span>
<span class="sd">        separate from the GeneralDispatch or other Dispatch classes). It first</span>
<span class="sd">        creates an empty Concrete Model from Pyomo, then generates Parameters</span>
<span class="sd">        from the parameter dictionary, Variables, Objectives and Constraints.</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">            params (dict)                : dictionary of Pyomo dispatch parameters</span>
<span class="sd">            unitRegistry (pint.registry) : unique unit Pint unit registry</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">u_pyomo</span> <span class="o">=</span> <span class="n">u_pyomo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dual</span>    <span class="o">=</span> <span class="n">dual</span>    <span class="c1"># are we combining solar + nuclear?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">direct</span>  <span class="o">=</span> <span class="n">direct</span>  <span class="c1"># are we directly heating storage?</span></div>

        
<div class="viewcode-block" id="GeneralDispatch.set_up"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.GeneralDispatch.GeneralDispatch.set_up">[docs]</a>    <span class="k">def</span> <span class="nf">set_up</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
                
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">ConcreteModel</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generate_params</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generate_variables</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_objective</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generate_constraints</span><span class="p">()</span></div>
        
        <span class="c1"># assert_units_consistent(self.model)</span>
        

<div class="viewcode-block" id="GeneralDispatch.generate_params"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.GeneralDispatch.GeneralDispatch.generate_params">[docs]</a>    <span class="k">def</span> <span class="nf">generate_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to generate parameters within Pyomo General Model</span>
<span class="sd">        </span>
<span class="sd">        This method reads in a dictionary of pyomo parameters and uses these</span>
<span class="sd">        inputs to initialize parameters for the Pyomo Concrete Model. This method</span>
<span class="sd">        sets up parameters particularly for the Power Cycle. It also defines</span>
<span class="sd">        some lambda functions that helps convert Pint units to Pyomo units.</span>
<span class="sd">        </span>
<span class="sd">        Note: initial conditions are defined for the time period immediately </span>
<span class="sd">        preceding the start of this new Pyomo time segment. </span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">            params (dict)  : dictionary of Pyomo dispatch parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">time_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;T&quot;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># this is a lambda function to grab Pint Quantity magntitude if it has one (gm = get magnitude)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gm</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">param_str</span><span class="p">:</span> <span class="n">params</span><span class="p">[</span><span class="n">param_str</span><span class="p">]</span><span class="o">.</span><span class="n">m</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">param_str</span><span class="p">],</span><span class="s1">&#39;m&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">params</span><span class="p">[</span><span class="n">param_str</span><span class="p">]</span>
        <span class="n">gm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gm</span>
        <span class="c1"># creates dictionary if parameter happens to be a time-indexed parameter (gd = get dictionary)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gd</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">param_str</span><span class="p">:</span> <span class="p">{</span><span class="n">ind</span><span class="p">:</span><span class="n">val</span> <span class="k">for</span> <span class="p">(</span><span class="n">ind</span><span class="p">,</span><span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">time_range</span><span class="p">,</span> <span class="n">gm</span><span class="p">(</span><span class="n">param_str</span><span class="p">))}</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">gm</span><span class="p">(</span><span class="n">param_str</span><span class="p">))</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="k">else</span> <span class="n">gm</span><span class="p">(</span><span class="n">param_str</span><span class="p">)</span>
        <span class="n">gd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gd</span>
        <span class="c1"># shortening definition name for converting Pint units to pyomo units (gu = get unit)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gu</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">param_str</span><span class="p">:</span> <span class="n">SSCHelperMethods</span><span class="o">.</span><span class="n">convert_to_pyomo_unit</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">param_str</span><span class="p">)</span>
        <span class="n">gu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gu</span>
        
        <span class="c1">### Time Indexed Parameters ###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span> <span class="o">=</span> <span class="n">time_range</span><span class="p">)</span>            <span class="c1">#T: time periods</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">num_periods</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;T&quot;</span><span class="p">])</span> <span class="c1">#N_T: number of time periods</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Delta</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">mutable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;Delta&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;Delta&quot;</span><span class="p">))</span>          <span class="c1">#\Delta_{t}: duration of period t</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Delta_e</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">mutable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;Delta_e&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;Delta_e&quot;</span><span class="p">))</span>    <span class="c1">#\Delta_{e,t}: cumulative time elapsed at end of period t</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">D</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;D&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;D&quot;</span><span class="p">))</span>                          <span class="c1">#D_{t}: Time-weighted discount factor in period $t$ [-]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">etaamb</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;etaamb&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;etaamb&quot;</span><span class="p">))</span>           <span class="c1">#\eta^{amb}_{t}: Cycle efficiency ambient temperature adjustment factor in period $t$ [-]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">etac</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;etac&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;etac&quot;</span><span class="p">))</span>                 <span class="c1">#\eta^{c}_{t}: Normalized condenser parasitic loss in period $t$ [-] </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">))</span>                          <span class="c1">#P_{t}: Electricity sales price in period $t$ [\$/kWh]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Qc</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;Qc&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;Qc&quot;</span><span class="p">))</span>                       <span class="c1">#Q^{c}_{t}: Allowable power per period for cycle start-up in period $t$ [kWt]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Wdotnet</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;Wdotnet&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;Wdotnet&quot;</span><span class="p">))</span>        <span class="c1">#\dot{W}^{net}_{t}: Net grid transmission upper limit in period $t$ [kWe]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">W_u_plus</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;W_u_plus&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;W_u_plus&quot;</span><span class="p">))</span>     <span class="c1">#W^{u+}_{t}: Maximum power production when starting generation in period $t$  [kWe]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">W_u_minus</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;W_u_minus&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;W_u_minus&quot;</span><span class="p">))</span>  <span class="c1">#W^{u-}_{t}: Maximum power production in period $t$ when stopping generation in period $t+1$  [kWe]</span>

        <span class="c1">### Power Cycle Parameters ###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Ec</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;Ec&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;Ec&quot;</span><span class="p">))</span>           <span class="c1">#E^c: Required energy expended to start cycle [kWt$\cdot$h]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">eta_des</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;eta_des&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;eta_des&quot;</span><span class="p">))</span>   <span class="c1">#\eta^{des}: Cycle nominal efficiency [-] </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Eu</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;Eu&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;Eu&quot;</span><span class="p">))</span>                <span class="c1">#E^u: Thermal energy storage capacity [kWt$\cdot$h]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">etap</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;etap&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;etap&quot;</span><span class="p">))</span>     <span class="c1">#\eta^p: Slope of linear approximation of power cycle performance curve [kWe/kWt]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Lc</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;Lc&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;Lc&quot;</span><span class="p">))</span>           <span class="c1">#L^c: Cycle heat transfer fluid pumping power per unit energy expended [kWe/kWt]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Qb</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;Qb&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;Qb&quot;</span><span class="p">))</span>           <span class="c1">#Q^b: Cycle standby thermal power consumption per period [kWt]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Ql</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;Ql&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;Ql&quot;</span><span class="p">))</span>           <span class="c1">#Q^l: Minimum operational thermal power input to cycle [kWt]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Qu</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;Qu&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;Qu&quot;</span><span class="p">))</span>           <span class="c1">#Q^u: Cycle thermal power capacity [kWt]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Wb</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;Wb&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;Wb&quot;</span><span class="p">))</span>           <span class="c1">#W^b: Power cycle standby operation parasitic load [kWe]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Wdotl</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;Wdotl&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;Wdotl&quot;</span><span class="p">))</span>          <span class="c1">#\dot{W}^l: Minimum cycle electric power output [kWe]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Wdotu</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;Wdotu&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;Wdotu&quot;</span><span class="p">))</span>          <span class="c1">#\dot{W}^u: Cycle electric power rated capacity [kWe]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">W_delta_plus</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;W_delta_plus&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;W_delta_plus&quot;</span><span class="p">))</span>    <span class="c1">#W^{\Delta+}: Power cycle ramp-up designed limit [kWe/h]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">W_delta_minus</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;W_delta_minus&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;W_delta_minus&quot;</span><span class="p">))</span> <span class="c1">#W^{\Delta-}: Power cycle ramp-down designed limit [kWe/h]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">W_v_plus</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;W_v_plus&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;W_v_plus&quot;</span><span class="p">))</span>       <span class="c1">#W^{v+}: Power cycle ramp-up violation limit [kWe/h]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">W_v_minus</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;W_v_minus&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;W_v_minus&quot;</span><span class="p">))</span>    <span class="c1">#W^{v-}: Power cycle ramp-down violation limit [kWe/h]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Yu</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;Yu&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;Yu&quot;</span><span class="p">))</span>           <span class="c1">#Y^u: Minimum required power cycle uptime [h]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Yd</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;Yd&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;Yd&quot;</span><span class="p">))</span>           <span class="c1">#Y^d: Minimum required power cycle downtime [h]</span>

        <span class="c1">### Cost Parameters ###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">))</span>           <span class="c1">#\alpha: Conversion factor between unitless and monetary values [\$]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Cpc</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;Cpc&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;Cpc&quot;</span><span class="p">))</span>                 <span class="c1">#C^{pc}: Operating cost of power cycle [\$/kWe$\cdot$h]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Ccsu</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;Ccsu&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;Ccsu&quot;</span><span class="p">))</span>              <span class="c1">#C^{csu}: Penalty for power cycle cold start-up [\$/start]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Cchsp</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;Cchsp&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;Cchsp&quot;</span><span class="p">))</span>           <span class="c1">#C^{chsp}: Penalty for power cycle hot start-up [\$/start]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">C_delta_w</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;C_delta_w&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;C_delta_w&quot;</span><span class="p">))</span>    <span class="c1">#C^{\delta_w}: Penalty for change in power cycle  production [\$/$\Delta\text{kWe}$]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">C_v_w</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;C_v_w&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;C_v_w&quot;</span><span class="p">))</span>           <span class="c1">#C^{v_w}: Penalty for change in power cycle  production tcb{beyond designed limits} [\$/$\Delta\text{kWe}$]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Ccsb</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;Ccsb&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;Ccsb&quot;</span><span class="p">))</span>              <span class="c1">#C^{csb}: Operating cost of power cycle standby operation [\$/kWt$\cdot$h]</span>
        
        <span class="c1">### Initial Condition Parameters ###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">s0</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;s0&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;s0&quot;</span><span class="p">))</span>           <span class="c1">#s_0: Initial TES reserve quantity  [kWt$\cdot$h]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ucsu0</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;ucsu0&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;ucsu0&quot;</span><span class="p">))</span> <span class="c1">#u^{csu}_0: Initial cycle start-up energy inventory  [kWt$\cdot$h]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">wdot0</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;wdot0&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;wdot0&quot;</span><span class="p">))</span> <span class="c1">#\dot{w}_0: Initial power cycle electricity generation [kW]e</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">y0</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;y0&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;y0&quot;</span><span class="p">))</span>          <span class="c1">#y_0: 1 if cycle is generating electric power initially, 0 otherwise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ycsb0</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;ycsb0&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;ycsb0&quot;</span><span class="p">))</span> <span class="c1">#y^{csb}_0: 1 if cycle is in standby mode initially, 0 otherwise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ycsu0</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;ycsu0&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;ycsu0&quot;</span><span class="p">))</span> <span class="c1">#y^{csu}_0: 1 if cycle is in starting up initially, 0 otherwise    [az] this is new.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Yu0</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;Yu0&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;Yu0&quot;</span><span class="p">))</span>       <span class="c1">#Y^u_0: duration that cycle has been generating electric power [h]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Yd0</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">gd</span><span class="p">(</span><span class="s2">&quot;Yd0&quot;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">gu</span><span class="p">(</span><span class="s2">&quot;Yd0&quot;</span><span class="p">))</span>       <span class="c1">#Y^d_0: duration that cycle has not been generating power (i.e., shut down or in standby mode) [h]</span></div>
        
        <span class="c1">#------- Persistence Parameters ---------</span>
        <span class="c1"># TODO: removing references to wdot_s_prev, they only exist as Constraints and should later be added to Objective somehow</span>
        <span class="c1"># self.model.wdot_s_prev  = pe.Param(self.model.T, mutable=True, initialize=gd(&quot;wdot_s_prev&quot;), units=gu(&quot;wdot_s_prev&quot;)) #\dot{w}^{s,prev}: previous $\dot{w}^s$, or energy sold to grid [kWe]</span>
        <span class="c1"># self.model.wdot_s_pen  = pe.Param(self.model.T, mutable=True, initialize=gd(&quot;wdot_s_pen&quot;), units=gu(&quot;delta_rs&quot;))    #\dot{w}_{s,pen}: previous $\dot{w}$ </span>


<div class="viewcode-block" id="GeneralDispatch.generate_variables"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.GeneralDispatch.GeneralDispatch.generate_variables">[docs]</a>    <span class="k">def</span> <span class="nf">generate_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to generate parameters within Pyomo General Model</span>
<span class="sd">        </span>
<span class="sd">        This method instantiates variables for the Pyomo Concrete Model, with</span>
<span class="sd">        domains. Does not need initial guesses here, they are defined in the </span>
<span class="sd">        parameters. Here we define continuous and binary variables for the </span>
<span class="sd">        Power Cycle. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_pyomo</span>
        <span class="c1">### Decision Variables ###</span>
        <span class="c1">#------- Variables ---------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pe</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">,</span> <span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Eu</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">kWh</span><span class="p">)</span>    <span class="c1">#s: TES reserve quantity at period $t$  [kWt$\cdot$h]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ucsu</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pe</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">kWh</span><span class="p">)</span>                             <span class="c1">#u^{csu}: Cycle start-up energy inventory at period $t$ [kWt$\cdot$h]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">wdot</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pe</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">kW</span><span class="p">)</span>                              <span class="c1">#\dot{w}: Power cycle electricity generation at period $t$ [kWe]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">wdot_delta_plus</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pe</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">kW</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">hr</span><span class="p">)</span>	                <span class="c1">#\dot{w}^{\Delta+}: Power cycle ramp-up in period $t$ [kWe/hr]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">wdot_delta_minus</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pe</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">kW</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">hr</span><span class="p">)</span> 	                <span class="c1">#\dot{w}^{\Delta-}: Power cycle ramp-down in period $t$ [kWe/hr]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">wdot_v_plus</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pe</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">,</span> <span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">W_v_plus</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">kW</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">hr</span><span class="p">)</span>      <span class="c1">#\dot{w}^{v+}: Power cycle ramp-up beyond designed limit in period $t$ [kWe/hr]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">wdot_v_minus</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pe</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">,</span> <span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">W_v_minus</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">kW</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">hr</span><span class="p">)</span> 	 <span class="c1">#\dot{w}^{v-}: Power cycle ramp-down beyond designed limit in period $t$ [kWe/hr]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">wdot_s</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pe</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">kW</span><span class="p">)</span>	                       <span class="c1">#\dot{w}^s: Energy sold to grid in time t [kWe]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">wdot_p</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pe</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">kW</span><span class="p">)</span>	                       <span class="c1">#\dot{w}^p: Energy purchased from the grid in time t [kWe]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pe</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">kW</span><span class="p">)</span>                                <span class="c1">#x: Cycle thermal power utilization at period $t$ [kWt]</span>
        
        <span class="c1">#------- Binary Variables ---------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pe</span><span class="o">.</span><span class="n">Binary</span><span class="p">)</span>         <span class="c1">#y: 1 if cycle is generating electric power at period $t$; 0 otherwise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ychsp</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pe</span><span class="o">.</span><span class="n">Binary</span><span class="p">)</span>     <span class="c1">#y^{chsp}: 1 if cycle hot start-up penalty is incurred at period $t$ (from standby); 0 otherwise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ycsb</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pe</span><span class="o">.</span><span class="n">Binary</span><span class="p">)</span>      <span class="c1">#y^{csb}: 1 if cycle is in standby mode at period $t$; 0 otherwise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ycsd</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pe</span><span class="o">.</span><span class="n">Binary</span><span class="p">)</span>	  <span class="c1">#y^{csd}: 1 if cycle is shutting down at period $t$; 0 otherwise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ycsu</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pe</span><span class="o">.</span><span class="n">Binary</span><span class="p">)</span>      <span class="c1">#y^{csu}: 1 if cycle is starting up at period $t$; 0 otherwise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ycsup</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pe</span><span class="o">.</span><span class="n">Binary</span><span class="p">)</span>     <span class="c1">#y^{csup}: 1 if cycle cold start-up penalty is incurred at period $t$ (from off); 0 otherwise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ycgb</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pe</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>      <span class="c1">#y^{cgb}: 1 if cycle begins electric power generation at period $t$; 0 otherwise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ycge</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pe</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>      <span class="c1">#y^{cge}: 1 if cycle stops electric power generation at period $t$; 0 otherwise</span></div>
        
        <span class="c1">#------- Persistence Variables ---------</span>
        <span class="c1"># TODO: revisit wdot_s_prev references later</span>
        <span class="c1"># self.model.wdot_s_prev_delta_plus = pe.Var(self.model.T, domain=pe.NonNegativeReals)  #\dot{w}^{\Delta+}_{s,prev}: upper bound on energy sold [kWe]</span>
        <span class="c1"># self.model.wdot_s_prev_delta_minus = pe.Var(self.model.T, domain=pe.NonNegativeReals) #\dot{w}^{\Delta-}_{s,prev}: lower bound on energy sold [kWe]</span>
        <span class="c1"># self.model.ycoff = pe.Var(self.model.T, domain=pe.Binary)     #y^{c,off}: 1 if power cycle is off at period $t$; 0 otherwise</span>
        
<div class="viewcode-block" id="GeneralDispatch.add_objective"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.GeneralDispatch.GeneralDispatch.add_objective">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">add_objective</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to add an objective function to the Pyomo General Model</span>
<span class="sd">        </span>
<span class="sd">        This method adds an objective function to the Pyomo General Dispatch</span>
<span class="sd">        model. Typically, the LORE team defined a nested function and passes it</span>
<span class="sd">        into the Pyomo model. This version of the method should not be called,</span>
<span class="sd">        is designated as an abstract method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">def</span> <span class="nf">objectiveRule</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; Maximize profits &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="p">(</span>
                    <span class="nb">sum</span><span class="p">(</span> <span class="n">model</span><span class="o">.</span><span class="n">D</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">Delta</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> 
                    <span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">OBJ</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Objective</span><span class="p">(</span><span class="n">rule</span><span class="o">=</span><span class="n">objectiveRule</span><span class="p">,</span> <span class="n">sense</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">maximize</span><span class="p">)</span></div>


<div class="viewcode-block" id="GeneralDispatch.addPersistenceConstraints"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.GeneralDispatch.GeneralDispatch.addPersistenceConstraints">[docs]</a>    <span class="k">def</span> <span class="nf">addPersistenceConstraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to add persistence constraints to the Pyomo General Model</span>
<span class="sd">        </span>
<span class="sd">        This method adds constraints pertaining to persistence within the Pyomo</span>
<span class="sd">        General Dispatch class. Namely, it constraints the amount of energy</span>
<span class="sd">        sold into the grid in timestep t+1 relative to timestep t. It makes sure</span>
<span class="sd">        that amount doesn&#39;t fluctuate by too much, whether increansig or decreasing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># TODO: wdot_s_prev should be a single float, there should be an {if t==1} statement for wdot_s_prev</span>
        <span class="c1">#              and for all other t, we compare wdot_s[t] - wdot_s[t-1]</span>
        <span class="k">def</span> <span class="nf">wdot_s_persist_pos_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; Energy sold shouldn&#39;t increase too much &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">wdot_s_prev_delta_plus</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">wdot_s</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">wdot_s_prev</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="k">def</span> <span class="nf">wdot_s_persist_neg_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; Energy sold shouldn&#39;t decrease too much &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">wdot_s_prev_delta_minus</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">wdot_s_prev</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">wdot_s</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">persist_pos_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">wdot_s_persist_pos_rule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">persist_neg_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">wdot_s_persist_neg_rule</span><span class="p">)</span></div>
        
        
<div class="viewcode-block" id="GeneralDispatch.addCycleStartupConstraints"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.GeneralDispatch.GeneralDispatch.addCycleStartupConstraints">[docs]</a>    <span class="k">def</span> <span class="nf">addCycleStartupConstraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to add cycle startup constraints to the Pyomo General Model</span>
<span class="sd">        </span>
<span class="sd">        This method adds constraints pertaining to cycle startup within the Pyomo</span>
<span class="sd">        General Dispatch class. Several nested functions are defined. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">pc_inventory_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; PC energy inventory for startup is balanced &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">ucsu</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">ucsu0</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">Delta</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">Qc</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">ycsu</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">ucsu</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">ucsu</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">Delta</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">Qc</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">ycsu</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="k">def</span> <span class="nf">pc_inv_nonzero_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; PC energy inventory is positive if cycle starting up &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">ucsu</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">Ec</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">ycsu</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="k">def</span> <span class="nf">pc_startup_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; PC resumes normal operation after startup, standby, or previously operating &quot;&quot;&quot;</span>
            <span class="n">current_Delta</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Delta</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
            <span class="c1"># structure of inequality is lb &lt;= model.param &lt;= ub with strict=False by default</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_ineq</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">current_Delta</span><span class="p">)</span> <span class="ow">and</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">ucsu</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">/</span><span class="n">model</span><span class="o">.</span><span class="n">Ec</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">y0</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">ycsb0</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_ineq</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">current_Delta</span><span class="p">)</span> <span class="ow">and</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">ucsu</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">/</span><span class="n">model</span><span class="o">.</span><span class="n">Ec</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">ycsb</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_ineq</span><span class="p">(</span><span class="n">current_Delta</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="ow">and</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_ineq</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">model</span><span class="o">.</span><span class="n">ucsu0</span><span class="o">/</span><span class="n">model</span><span class="o">.</span><span class="n">Ec</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">y0</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">ycsb0</span><span class="p">)</span>
            <span class="c1"># only case remaining: Delta[t]&lt;1, t&gt;1</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_ineq</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">model</span><span class="o">.</span><span class="n">ucsu</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">model</span><span class="o">.</span><span class="n">Ec</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">ycsb</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">def</span> <span class="nf">pc_production_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; Heat input used for PC startup doesn&#39;t exceed max &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">Qc</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">ycsu</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">Qu</span>
        <span class="k">def</span> <span class="nf">pc_generation_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; Upper bound on heat input to PC &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">Qu</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="k">def</span> <span class="nf">pc_min_gen_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; Lower bound on heat input to PC &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">Ql</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">pc_inventory_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">pc_inventory_rule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">pc_inv_nonzero_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">pc_inv_nonzero_rule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">pc_startup_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">pc_startup_rule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">pc_production_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">pc_production_rule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">pc_generation_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">pc_generation_rule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">pc_min_gen_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">pc_min_gen_rule</span><span class="p">)</span></div>
        
        
<div class="viewcode-block" id="GeneralDispatch.addPiecewiseLinearEfficiencyConstraints"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.GeneralDispatch.GeneralDispatch.addPiecewiseLinearEfficiencyConstraints">[docs]</a>    <span class="k">def</span> <span class="nf">addPiecewiseLinearEfficiencyConstraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to add efficiency constraints to the Pyomo General Model</span>
<span class="sd">        </span>
<span class="sd">        This method adds constraints pertaining to efficiency constraints defined</span>
<span class="sd">        as a piecewise linear approximation. Also referred to as Cycle supply and </span>
<span class="sd">        demand constraints.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">power_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; Model of electric power vs. heat input as linear function &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">wdot</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">etaamb</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">/</span><span class="n">model</span><span class="o">.</span><span class="n">eta_des</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">etap</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Wdotu</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">etap</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">Qu</span><span class="p">))</span>
        <span class="k">def</span> <span class="nf">power_ub_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; Upper bound on PC electric power output &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">wdot</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">Wdotu</span><span class="o">*</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">etaamb</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">/</span><span class="n">model</span><span class="o">.</span><span class="n">eta_des</span><span class="p">)</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="k">def</span> <span class="nf">power_lb_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; Lower bound on PC electric power output &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">wdot</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">Wdotl</span><span class="o">*</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">etaamb</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">/</span><span class="n">model</span><span class="o">.</span><span class="n">eta_des</span><span class="p">)</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="k">def</span> <span class="nf">change_in_w_pos_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; Limit on increase in electric power production &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">wdot_delta_plus</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">wdot</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">wdot0</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">wdot_delta_plus</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">wdot</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">wdot</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">def</span> <span class="nf">change_in_w_neg_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; Limit on decrease in electric power production &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">wdot_delta_minus</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">wdot0</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">wdot</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">wdot_delta_minus</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">wdot</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">wdot</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="k">def</span> <span class="nf">cycle_ramp_rate_pos_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; Limit on excessive ramp up of PC power production &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="p">(</span>
                    <span class="n">model</span><span class="o">.</span><span class="n">wdot_delta_plus</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">wdot_v_plus</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">W_delta_plus</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">Delta</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> 
                    <span class="o">+</span> <span class="p">((</span><span class="n">model</span><span class="o">.</span><span class="n">etaamb</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">/</span><span class="n">model</span><span class="o">.</span><span class="n">eta_des</span><span class="p">)</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">W_u_plus</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">W_delta_plus</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">Delta</span><span class="p">[</span><span class="n">t</span><span class="p">])</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">ycgb</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">def</span> <span class="nf">cycle_ramp_rate_neg_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; Limit on excessive ramp down of PC power production&quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="p">(</span>
                    <span class="n">model</span><span class="o">.</span><span class="n">wdot_delta_minus</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">wdot_v_minus</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">W_delta_minus</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">Delta</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> 
                    <span class="o">+</span> <span class="p">((</span><span class="n">model</span><span class="o">.</span><span class="n">etaamb</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">/</span><span class="n">model</span><span class="o">.</span><span class="n">eta_des</span><span class="p">)</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">W_u_minus</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">W_delta_minus</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">Delta</span><span class="p">[</span><span class="n">t</span><span class="p">])</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">ycge</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">def</span> <span class="nf">grid_max_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; Limits grid transmission for net power production &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">wdot_s</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">Wdotnet</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>

        
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">power_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">power_rule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">power_ub_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">power_ub_rule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">power_lb_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">power_lb_rule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">change_in_w_pos_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">change_in_w_pos_rule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">change_in_w_neg_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">change_in_w_neg_rule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">cycle_ramp_rate_pos_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">cycle_ramp_rate_pos_rule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">cycle_ramp_rate_neg_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">cycle_ramp_rate_neg_rule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">grid_max_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">grid_max_rule</span><span class="p">)</span></div>
        
        
<div class="viewcode-block" id="GeneralDispatch.addMinUpAndDowntimeConstraints"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.GeneralDispatch.GeneralDispatch.addMinUpAndDowntimeConstraints">[docs]</a>    <span class="k">def</span> <span class="nf">addMinUpAndDowntimeConstraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to add up and downtime constraints to the Pyomo General Model</span>
<span class="sd">        </span>
<span class="sd">        This method adds constraints pertaining to enforcing minimum uptime</span>
<span class="sd">        and downtime of the power cycle whenever it starts or ends operation,</span>
<span class="sd">        respectively. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">min_cycle_uptime_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; Enforce minimum cycle uptime &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">pe</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Delta_e</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Yu</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">Yu0</span><span class="p">)</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">y0</span><span class="p">):</span>
                <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">ycgb</span><span class="p">[</span><span class="n">tp</span><span class="p">]</span> <span class="k">for</span> <span class="n">tp</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">T</span> <span class="k">if</span> <span class="n">pe</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Delta_e</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">-</span><span class="n">model</span><span class="o">.</span><span class="n">Delta_e</span><span class="p">[</span><span class="n">tp</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">model</span><span class="o">.</span><span class="n">Yu</span><span class="p">)</span> <span class="ow">and</span> <span class="n">pe</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Delta_e</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">Delta_e</span><span class="p">[</span><span class="n">tp</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="o">.</span><span class="n">Feasible</span>
        <span class="k">def</span> <span class="nf">min_cycle_downtime_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; Enforce minimum cycle downtime &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">pe</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Delta_e</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&gt;</span> <span class="p">((</span><span class="n">model</span><span class="o">.</span><span class="n">Yd</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">Yd0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model</span><span class="o">.</span><span class="n">y0</span><span class="p">))):</span>
                <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span> <span class="n">model</span><span class="o">.</span><span class="n">ycge</span><span class="p">[</span><span class="n">tp</span><span class="p">]</span> <span class="k">for</span> <span class="n">tp</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">T</span> <span class="k">if</span> <span class="n">pe</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Delta_e</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">-</span><span class="n">model</span><span class="o">.</span><span class="n">Delta_e</span><span class="p">[</span><span class="n">tp</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">model</span><span class="o">.</span><span class="n">Yd</span><span class="p">)</span> <span class="ow">and</span> <span class="n">pe</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Delta_e</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">Delta_e</span><span class="p">[</span><span class="n">tp</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">))</span>  <span class="o">&lt;=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="o">.</span><span class="n">Feasible</span>
        <span class="k">def</span> <span class="nf">cycle_start_end_gen_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; Tracks startup and shutdown of plants (Garver 1962) &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">ycgb</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">ycge</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">==</span> <span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">y0</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">ycgb</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">ycge</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">==</span> <span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">def</span> <span class="nf">cycle_min_updown_init_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; Initial conditions for minimum uptime/downtime constraints &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_ineq</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Delta_e</span><span class="p">[</span><span class="n">t</span><span class="p">],</span>
                              <span class="nb">max</span><span class="p">(</span><span class="n">pe</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">y0</span><span class="o">*</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Yu</span><span class="o">-</span><span class="n">model</span><span class="o">.</span><span class="n">Yu0</span><span class="p">)),</span> <span class="n">pe</span><span class="o">.</span><span class="n">value</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">model</span><span class="o">.</span><span class="n">y0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Yd</span><span class="o">-</span><span class="n">model</span><span class="o">.</span><span class="n">Yd0</span><span class="p">)))):</span>
                <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">==</span> <span class="n">model</span><span class="o">.</span><span class="n">y0</span>
            <span class="k">return</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="o">.</span><span class="n">Feasible</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">min_cycle_uptime_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">min_cycle_uptime_rule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">min_cycle_downtime_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">min_cycle_downtime_rule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">cycle_start_end_gen_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">cycle_start_end_gen_rule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">cycle_min_updown_init_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">cycle_min_updown_init_rule</span><span class="p">)</span></div>
        
        
<div class="viewcode-block" id="GeneralDispatch.addCycleLogicConstraints"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.GeneralDispatch.GeneralDispatch.addCycleLogicConstraints">[docs]</a>    <span class="k">def</span> <span class="nf">addCycleLogicConstraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to add cycle logic constraints to the Pyomo General Model</span>
<span class="sd">        </span>
<span class="sd">        This method adds constraints pertaining to tracking binary variable</span>
<span class="sd">        logic for the power cycle. Essentially, to make sure the correct modes</span>
<span class="sd">        are activated when they are allowed. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">pc_su_persist_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; PC startup can&#39;t follow an operating timestep &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">ycsu</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">y0</span> <span class="o">&lt;=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">ycsu</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1</span>
        <span class="k">def</span> <span class="nf">pc_su_subhourly_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; PC startup and operation can&#39;t coincide &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_ineq</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Delta</span><span class="p">[</span><span class="n">t</span><span class="p">],</span><span class="mi">1</span><span class="p">,</span><span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">ycsu</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="o">.</span><span class="n">Feasible</span>  <span class="c1">#no analogous constraint for hourly or longer time steps</span>
        <span class="k">def</span> <span class="nf">pc_sb_start_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; PC standby must follow operating or another standby timestep &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">ycsb</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">y0</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">ycsb0</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">ycsb</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">ycsb</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">def</span> <span class="nf">pc_sb_part1_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; PC startup and standby can&#39;t coincide &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">ycsu</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">ycsb</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1</span>
        <span class="k">def</span> <span class="nf">pc_sb_part2_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; PC operation and standby can&#39;t coincide &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">ycsb</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1</span>
        <span class="k">def</span> <span class="nf">cycle_sb_pen_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; PC hot startup penalty: if we went from standby to operating &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                 <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">ychsp</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">ycsb0</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">ychsp</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">ycsb</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">def</span> <span class="nf">cycle_shutdown_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; PC shutdown only after operating or standby &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">ycsd</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">y0</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">ycsb0</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">ycsb</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">ycsd</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">ycsb</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">ycsb</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="k">def</span> <span class="nf">cycle_start_pen_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; PC cold startup penalty &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> 
                <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">ycsup</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">ycsu</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">ycsu0</span> 
            <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">ycsup</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">ycsu</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">ycsu</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
         
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">pc_su_persist_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">pc_su_persist_rule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">pc_su_subhourly_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">pc_su_subhourly_rule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">pc_sb_start_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">pc_sb_start_rule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">pc_sb_part1_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">pc_sb_part1_rule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">pc_sb_part2_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">pc_sb_part2_rule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">cycle_sb_pen_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">cycle_sb_pen_rule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">cycle_shutdown_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">cycle_shutdown_rule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">cycle_start_pen_con</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">cycle_start_pen_rule</span><span class="p">)</span></div>
        


<div class="viewcode-block" id="GeneralDispatch.generate_constraints"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.GeneralDispatch.GeneralDispatch.generate_constraints">[docs]</a>    <span class="k">def</span> <span class="nf">generate_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to add ALL constraints to the Pyomo General Model</span>
<span class="sd">        </span>
<span class="sd">        This method calls the previously defined constraint methods to instantiate</span>
<span class="sd">        them and add to the existing model. This method can be called from a </span>
<span class="sd">        derived class as well as overloaded.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># self.addPersistenceConstraints() # TODO: revisit these constraints later when we know how to add a term to Objective</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addPiecewiseLinearEfficiencyConstraints</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addCycleStartupConstraints</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addMinUpAndDowntimeConstraints</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addCycleLogicConstraints</span><span class="p">()</span></div>
    
    
<div class="viewcode-block" id="GeneralDispatch.eval_ineq"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.GeneralDispatch.GeneralDispatch.eval_ineq">[docs]</a>    <span class="k">def</span> <span class="nf">eval_ineq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">ub</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to evaluate an inequality using pyomo syntax</span>
<span class="sd">        </span>
<span class="sd">        This is a helper method to evaluate an inequality using the specific</span>
<span class="sd">        pyomo syntax needed to evaluate when solving the model. </span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">            lb (**)       : lower bound of inequality</span>
<span class="sd">            expr (**)     : middle value of inequality</span>
<span class="sd">            ub (**)       : upper bound of inequality (if exists)</span>
<span class="sd">            strict (bool) : strictness of inequality (True means &lt; or &gt;)</span>
<span class="sd">            val (bool)    : flag to return value instead of expression</span>
<span class="sd">        Outputs:</span>
<span class="sd">            ineq (logical expr or float) : evaluated expression as a Pyomo object or float</span>
<span class="sd">            </span>
<span class="sd">        (**) - can either be a float input or a ParamData object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ineq</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">inequality</span><span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">ub</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="n">strict</span><span class="p">)</span>
        
        <span class="c1"># return value if requested, otherwise return Inequality Expression</span>
        <span class="k">if</span> <span class="n">val</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pe</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">ineq</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ineq</span></div>


<div class="viewcode-block" id="GeneralDispatch.solve_model"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.GeneralDispatch.GeneralDispatch.solve_model">[docs]</a>    <span class="k">def</span> <span class="nf">solve_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mipgap</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">tee</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">run_simple</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to solve the Pyomo model</span>
<span class="sd">        </span>
<span class="sd">        This method solves the Pyomo Concrete model that has been instantiated</span>
<span class="sd">        and constructed in the __init__ of this class. The MILP (mixed integer</span>
<span class="sd">        linear programming) problem is solved using a CBC (coin-or branch and cut)</span>
<span class="sd">        solver that should be installed prior to solving. It takes in an input</span>
<span class="sd">        for the MIP or Ratio gap. It is a termination condition for the optimization:</span>
<span class="sd">        if the difference between the best known solution and worst known solution</span>
<span class="sd">        (lower and upper bounds, respectively) is lower than this gap, we have</span>
<span class="sd">        found our optimal solution. Here is a good primer:</span>
<span class="sd">            https://www.gurobi.com/resource/mip-basics/</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">            mipgap (float): </span>
<span class="sd">                minimum gap to find optimal solution</span>
<span class="sd">        Outputs:</span>
<span class="sd">            results (SolverResults) : </span>
<span class="sd">                dictionary of solver output after optimization, contains </span>
<span class="sd">                information on convergence, etc.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># define solver (Coin-or branch and cut)</span>
        <span class="n">opt</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">SolverFactory</span><span class="p">(</span><span class="s1">&#39;cbc&#39;</span><span class="p">)</span>
        
        <span class="c1"># setting optimality condition</span>
        <span class="n">opt</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;ratioGap&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mipgap</span>
        
        <span class="k">if</span> <span class="n">run_simple</span><span class="p">:</span>
            <span class="n">opt</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;primalPivot&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;dantzig&quot;</span>
            <span class="n">opt</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;dualPivot&quot;</span><span class="p">]</span>   <span class="o">=</span> <span class="s2">&quot;dantzig&quot;</span>

        <span class="c1"># solving model</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">tee</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">keepfiles</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1">#TODO: assert successful optimization?</span>
        
        <span class="k">return</span> <span class="n">results</span></div></div>
    
    
<span class="c1"># =============================================================================</span>
<span class="c1"># Dispatch Wrapper</span>
<span class="c1"># =============================================================================</span>

<div class="viewcode-block" id="GeneralDispatchParamWrap"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.GeneralDispatch.GeneralDispatchParamWrap">[docs]</a><span class="k">class</span> <span class="nc">GeneralDispatchParamWrap</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The GeneralDispatchParamWrap class is meant to be the staging area for the </span>
<span class="sd">    creation of Parameters ONLY. It communicates with the NE2 modules, receiving</span>
<span class="sd">    SSC and PySAM input dictionaries to calculate both static parameters used </span>
<span class="sd">    for every simulation segment AND initial conditions that can be updated.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="GeneralDispatchParamWrap.__init__"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.GeneralDispatch.GeneralDispatchParamWrap.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit_registry</span><span class="p">,</span> <span class="n">SSC_dict</span><span class="p">,</span> <span class="n">PySAM_dict</span><span class="p">,</span> 
                       <span class="n">pyomo_horizon</span><span class="p">,</span> <span class="n">dispatch_time_step</span><span class="p">,</span> <span class="n">dual</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">direct</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                       <span class="n">interpolants</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Initializes the GeneralDispatchParamWrap module</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">            unitRegistry (pint.registry)   : unique unit Pint unit registry</span>
<span class="sd">            SSC_dict (dict)                : dictionary of SSC inputs needed to run modules</span>
<span class="sd">            PySAM_dict (dict)              : dictionary of PySAM inputs + file names</span>
<span class="sd">            pyomo_horizon (int Quant)      : length of Pyomo simulation segment (hours)</span>
<span class="sd">            dispatch_time_step (int Quant) : length of each Pyomo time step (hours)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">SSC_dict</span>           <span class="o">=</span> <span class="n">SSC_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PySAM_dict</span>         <span class="o">=</span> <span class="n">PySAM_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pyomo_horizon</span>      <span class="o">=</span> <span class="n">pyomo_horizon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dispatch_time_step</span> <span class="o">=</span> <span class="n">dispatch_time_step</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">interpolants</span>       <span class="o">=</span> <span class="n">interpolants</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">dual</span>    <span class="o">=</span> <span class="n">dual</span>    <span class="c1"># are we combining solar + nuclear?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">direct</span>  <span class="o">=</span> <span class="n">direct</span>  <span class="c1"># are we directly heating storage?</span>
        
        <span class="c1"># setting a standard unit registry</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">u</span> <span class="o">=</span> <span class="n">unit_registry</span> 
        
        <span class="c1"># retrieving the dry bulb temperature values in the SAM directory</span>
        <span class="n">parent_dir</span> <span class="o">=</span> <span class="n">FileMethods</span><span class="o">.</span><span class="n">parent_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solar_resource_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parent_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">PySAM_dict</span><span class="p">[</span><span class="s1">&#39;solar_resource_rel_parent&#39;</span><span class="p">])</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">Tdry</span> <span class="o">=</span> <span class="n">FileMethods</span><span class="o">.</span><span class="n">read_solar_resource_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">solar_resource_file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="p">)</span> 
        
        <span class="bp">self</span><span class="o">.</span><span class="n">set_design</span><span class="p">()</span></div>
        

<div class="viewcode-block" id="GeneralDispatchParamWrap.set_design"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.GeneralDispatch.GeneralDispatchParamWrap.set_design">[docs]</a>    <span class="k">def</span> <span class="nf">set_design</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to calculate and save design point values of Plant operation</span>
<span class="sd">        </span>
<span class="sd">        This method extracts values and calculates for design point parameters </span>
<span class="sd">        of our Plant (e.g., nuclear thermal power output, power cycle efficiency,</span>
<span class="sd">        inlet and outlet temperatures, etc.). </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span>
        
        <span class="c1"># alpha init</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">1.0</span>
        
        <span class="c1"># design parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_pb_design</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SSC_dict</span><span class="p">[</span><span class="s1">&#39;P_ref&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">MW</span>                  <span class="c1"># power block design electrical power</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eta_design</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SSC_dict</span><span class="p">[</span><span class="s1">&#39;design_eff&#39;</span><span class="p">]</span>                    <span class="c1"># power block design efficiency</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">q_pb_design</span>  <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p_pb_design</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta_design</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;MW&#39;</span><span class="p">)</span>  <span class="c1"># power block design thermal rating</span>
        
        <span class="c1"># temperature values at design point</span>
        <span class="k">if</span> <span class="s1">&#39;T_htf_hot_des&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">SSC_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">T_htf_hot</span>  <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SSC_dict</span><span class="p">[</span><span class="s1">&#39;T_htf_hot_des&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">celsius</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;degK&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">T_htf_hot</span>  <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SSC_dict</span><span class="p">[</span><span class="s1">&#39;T_htf_hot_des_steam&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">celsius</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;degK&#39;</span><span class="p">)</span>           
        <span class="bp">self</span><span class="o">.</span><span class="n">T_htf_cold</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SSC_dict</span><span class="p">[</span><span class="s1">&#39;T_htf_cold_des&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">celsius</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;degK&#39;</span><span class="p">)</span></div>
        
        
<div class="viewcode-block" id="GeneralDispatchParamWrap.set_time_indexed_parameters"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.GeneralDispatch.GeneralDispatchParamWrap.set_time_indexed_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">set_time_indexed_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param_dict</span><span class="p">,</span> <span class="n">df_array</span><span class="p">,</span> <span class="n">ud_array</span><span class="p">,</span> <span class="n">current_pyomo_slice</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to set time-indexed parameters for Dispatch optimization</span>
<span class="sd">        </span>
<span class="sd">        This method calculates time parameters for Pyomo Dispatch optimization.</span>
<span class="sd">        This includes time-step parameters, which by default are set to 1 hr</span>
<span class="sd">        so shouldn&#39;t cause problems.</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">            param_dict (dict) : dictionary of Pyomo dispatch parameters</span>
<span class="sd">            df_array (array)            : array of user defined dispatch factors over simulation time</span>
<span class="sd">            ud_array (list of list)     : table of user defined data as nested lists</span>
<span class="sd">            current_pyomo_slice (slice) : range of current pyomo horizon (ints representing hours)</span>
<span class="sd">        Outputs:</span>
<span class="sd">            param_dict (dict) : updated dictionary of Pyomo dispatch parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span>
        
        <span class="c1"># time parameters</span>
        <span class="n">pyoH</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyomo_horizon</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;hr&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">m</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T</span>       <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="n">pyoH</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Delta</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">dispatch_time_step</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;hr&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">m</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">hr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Delta_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Delta</span><span class="p">)</span>
        
        <span class="c1"># weight parameter</span>
        <span class="n">wt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PySAM_dict</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span>
        
        <span class="c1"># grab time series data that we have to index</span>
        <span class="n">Tdry</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tdry</span> <span class="c1"># dry bulb temperature from solar resource file </span>
        <span class="n">Price</span> <span class="o">=</span> <span class="n">df_array</span>  <span class="c1"># pricing multipliers</span>
        
        <span class="c1"># we now curtail any pyomo slice that goes above the full sim time</span>
        <span class="n">length_of_pyoH</span> <span class="o">=</span> <span class="n">current_pyomo_slice</span><span class="o">.</span><span class="n">stop</span> <span class="o">-</span> <span class="n">current_pyomo_slice</span><span class="o">.</span><span class="n">start</span>
        
        <span class="c1"># if we&#39;re at the last segment, we won&#39;t have 48 hour data for the sim. here is a quick fix</span>
        <span class="k">if</span> <span class="n">length_of_pyoH</span> <span class="o">&lt;</span> <span class="n">pyoH</span><span class="p">:</span>
            <span class="c1"># double-stacking arrays so we can get a slice past full sim time</span>
            <span class="n">Tdry</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">Tdry</span><span class="p">,</span>  <span class="n">Tdry</span><span class="p">])</span>
            <span class="n">Price</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">Price</span><span class="p">,</span> <span class="n">Price</span><span class="p">])</span>
            
            <span class="c1"># restructuring the pyomo slice</span>
            <span class="n">start</span>   <span class="o">=</span> <span class="n">current_pyomo_slice</span><span class="o">.</span><span class="n">start</span>
            <span class="n">newstop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">pyoH</span>
            <span class="n">current_pyomo_slice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span> <span class="n">start</span><span class="p">,</span> <span class="n">newstop</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            
        <span class="c1"># grabbing relevant dry temperatures</span>
        <span class="n">Tdry</span>   <span class="o">=</span> <span class="n">Tdry</span><span class="p">[</span><span class="n">current_pyomo_slice</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">Price</span><span class="p">[</span><span class="n">current_pyomo_slice</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">USD</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">kWh</span>
        
        <span class="c1"># ambient temperature fluctuations and updates</span>
        <span class="n">etamult</span><span class="p">,</span> <span class="n">wmult</span> <span class="o">=</span> <span class="n">SSCHelperMethods</span><span class="o">.</span><span class="n">get_ambient_T_corrections_from_udpc_inputs</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="p">,</span> <span class="n">Tdry</span><span class="p">,</span> <span class="n">ud_array</span> <span class="p">)</span> <span class="c1"># TODO:verify this makes sense</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">etaamb</span> <span class="o">=</span> <span class="n">etamult</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">SSC_dict</span><span class="p">[</span><span class="s1">&#39;design_eff&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">etac</span>   <span class="o">=</span> <span class="n">wmult</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">SSC_dict</span><span class="p">[</span><span class="s1">&#39;ud_f_W_dot_cool_des&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">100.</span>

        <span class="c1"># power into cycle, into grid, +/-</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Qc</span>         <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ec</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SSC_dict</span><span class="p">[</span><span class="s1">&#39;startup_time&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">hr</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Delta</span><span class="p">))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Delta</span><span class="p">)</span> <span class="c1">#TODO: make sure Ec is called correctly</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Wdotnet</span>    <span class="o">=</span> <span class="p">[</span><span class="mf">1.e10</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">)]</span> <span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">kW</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W_u_plus</span>   <span class="o">=</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">Wdotl</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">W_delta_plus</span><span class="o">*</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kW&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span> <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Delta</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">kW</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W_u_minus</span>  <span class="o">=</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">Wdotl</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">W_delta_minus</span><span class="o">*</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kW&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span> <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Delta</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">kW</span>
        
        <span class="c1"># time weights</span>
        <span class="n">n</span>  <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Delta</span><span class="p">)</span>
        <span class="n">D</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        
        <span class="c1"># looping through time</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">D</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>        <span class="o">=</span> <span class="n">wt</span><span class="o">**</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Delta_e</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">hr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">D</span> <span class="o">=</span> <span class="n">D</span>
        
        <span class="c1">#------- Time indexed parameters ---------</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span>         <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span>                   <span class="c1">#T: time periods</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;Delta&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Delta</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;hr&#39;</span><span class="p">)</span>      <span class="c1">#\Delta_{t}: duration of period t [hr]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;Delta_e&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Delta_e</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;hr&#39;</span><span class="p">)</span>    <span class="c1">#\Delta_{e,t}: cumulative time elapsed at end of period t [hr]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">]</span>         <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">D</span>                   <span class="c1">#D_{t}: Time-weighted discount factor in period $t$ [-]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;etaamb&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">etaamb</span>              <span class="c1">#\eta^{amb}_{t}: Cycle efficiency ambient temperature adjustment factor in period $t$ [-]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;etac&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">etac</span>                <span class="c1">#\eta^{c}_{t}: Normalized condenser parasitic loss in period $t$ [-] </span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span>         <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;USD/kWh&#39;</span><span class="p">)</span>     <span class="c1">#P_{t}: Electricity sales price in period $t$ [\$/kWh]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;Qc&#39;</span><span class="p">]</span>        <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Qc</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kW&#39;</span><span class="p">)</span>         <span class="c1">#Q^{c}_{t}: Allowable power per period for cycle start-up in period $t$ [kWt]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;Wdotnet&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wdotnet</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kW&#39;</span><span class="p">)</span>    <span class="c1">#\dot{W}^{net}_{t}: Net grid transmission upper limit in period $t$ [kWe]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;W_u_plus&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W_u_plus</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kW&#39;</span><span class="p">)</span>   <span class="c1">#W^{u+}_{t}: Maximum power production when starting generation in period $t$  [kWe]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;W_u_minus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W_u_minus</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kW&#39;</span><span class="p">)</span>  <span class="c1">#W^{u-}_{t}: Maximum power production in period $t$ when stopping generation in period $t+1$  [kWe]</span>
        
        <span class="k">return</span> <span class="n">param_dict</span></div>

    
<div class="viewcode-block" id="GeneralDispatchParamWrap.set_power_cycle_parameters"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.GeneralDispatch.GeneralDispatchParamWrap.set_power_cycle_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">set_power_cycle_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param_dict</span><span class="p">,</span> <span class="n">ud_array</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to set parameters specific to Power Cycle for Dispatch optimization</span>
<span class="sd">        </span>
<span class="sd">        This method calculates some steady-state parameters specific to the </span>
<span class="sd">        power cycle (PC) for use in Dispatch optimization. These parameters </span>
<span class="sd">        generally have to do with thermal ratings, and upper/lower bounds</span>
<span class="sd">        on capacities. </span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">            param_dict (dict)       : dictionary of Pyomo dispatch parameters</span>
<span class="sd">            ud_array (list of list) : table of user defined data as nested lists</span>
<span class="sd">        Outputs:</span>
<span class="sd">            param_dict (dict) : updated dictionary of Pyomo dispatch parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span>
        <span class="c1"># Magic numbers</span>
        <span class="n">Wb_frac</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PySAM_dict</span><span class="p">[</span><span class="s1">&#39;Wb_frac&#39;</span><span class="p">]</span>             <span class="c1"># TODO: get a better estimate- cycle standby parasitic load as frac of cycle capacity</span>
        <span class="n">pc_rampup</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PySAM_dict</span><span class="p">[</span><span class="s1">&#39;pc_rampup&#39;</span><span class="p">]</span>      <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">min</span>  <span class="c1"># Cycle max ramp up (fraction of capacity per minute)</span>
        <span class="n">pc_rampdown</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PySAM_dict</span><span class="p">[</span><span class="s1">&#39;pc_rampdown&#39;</span><span class="p">]</span>    <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">min</span>    
        <span class="n">pc_rampup_vl</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PySAM_dict</span><span class="p">[</span><span class="s1">&#39;pc_rampup_vl&#39;</span><span class="p">]</span>   <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">hr</span>   <span class="c1"># Cycle ramp up violation limit (fraction of capacity per minute)</span>
        <span class="n">pc_rampdown_vl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PySAM_dict</span><span class="p">[</span><span class="s1">&#39;pc_rampdown_vl&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">hr</span> 
        
        <span class="c1"># fixed parameter calculations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ec</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SSC_dict</span><span class="p">[</span><span class="s1">&#39;startup_frac&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_pb_design</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">SSC_dict</span><span class="p">[</span><span class="s1">&#39;startup_time&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">hr</span>      <span class="c1"># TODO: this should be an energy, multiplying by min startup time for now</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Lc</span>    <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SSC_dict</span><span class="p">[</span><span class="s1">&#39;pb_pump_coef&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">kW</span><span class="o">/</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">kg</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="p">))</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dm_pb_design</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kg/s&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_pb_design</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kW&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Qb</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SSC_dict</span><span class="p">[</span><span class="s1">&#39;q_sby_frac&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_pb_design</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ql</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SSC_dict</span><span class="p">[</span><span class="s1">&#39;cycle_cutoff_frac&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_pb_design</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Qu</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SSC_dict</span><span class="p">[</span><span class="s1">&#39;cycle_max_frac&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_pb_design</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Wb</span>    <span class="o">=</span> <span class="n">Wb_frac</span><span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_pb_design</span>
        
        <span class="c1">#linearized eta calculations</span>
        <span class="n">etap</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">SSCHelperMethods</span><span class="o">.</span><span class="n">get_linearized_ud_params</span><span class="p">(</span> <span class="n">ud_array</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_pb_design</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SSC_dict</span> <span class="p">)</span>
        <span class="n">Wdotl</span> <span class="o">=</span> <span class="n">b</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ql</span><span class="o">*</span><span class="n">etap</span>
        <span class="n">Wdotu</span> <span class="o">=</span> <span class="n">b</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Qu</span><span class="o">*</span><span class="n">etap</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">etap</span>  <span class="o">=</span> <span class="n">etap</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">Wdotl</span> <span class="o">=</span> <span class="n">Wdotl</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kW&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Wdotu</span> <span class="o">=</span> <span class="n">Wdotu</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kW&#39;</span><span class="p">)</span>
        
        <span class="c1"># fixed parameter calculations (ctd)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W_delta_plus</span>  <span class="o">=</span> <span class="n">pc_rampup</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wdotu</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">W_delta_minus</span> <span class="o">=</span> <span class="n">pc_rampdown</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wdotu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W_v_plus</span>      <span class="o">=</span> <span class="n">pc_rampup_vl</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wdotu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W_v_minus</span>     <span class="o">=</span> <span class="n">pc_rampdown_vl</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wdotu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Yu</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PySAM_dict</span><span class="p">[</span><span class="s1">&#39;Yu&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">hr</span>  <span class="c1"># TODO: get a better estimate - minimum required power cycle uptime </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Yd</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PySAM_dict</span><span class="p">[</span><span class="s1">&#39;Yd&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">hr</span>  <span class="c1"># TODO: get a better estimate - minimum required power cycle downtime </span>
        
        <span class="c1">### Power Cycle Parameters ###</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;Ec&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ec</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kWh&#39;</span><span class="p">)</span>  <span class="c1">#E^c: Required energy expended to start cycle [kWt$\cdot$h]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;eta_des&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta_design</span>    <span class="c1">#\eta^{des}: Cycle nominal efficiency [-]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;etap&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">etap</span>          <span class="c1">#\eta^p: Slope of linear approximation of power cycle performance curve [kWe/kWt]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;Lc&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Lc</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>     <span class="c1">#L^c: Cycle heat transfer fluid pumping power per unit energy expended [kWe/kWt]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;Qb&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Qb</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kW&#39;</span><span class="p">)</span>   <span class="c1">#Q^b: Cycle standby thermal power consumption per period [kWt]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;Ql&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ql</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kW&#39;</span><span class="p">)</span>   <span class="c1">#Q^l: Minimum operational thermal power input to cycle [kWt]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;Qu&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Qu</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kW&#39;</span><span class="p">)</span>   <span class="c1">#Q^u: Cycle thermal power capacity [kWt]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;Wb&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wb</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kW&#39;</span><span class="p">)</span>   <span class="c1">#W^b: Power cycle standby operation parasitic load [kWe]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;Wdotl&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wdotl</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kW&#39;</span><span class="p">)</span>         <span class="c1">#\dot{W}^l: Minimum cycle electric power output [kWe]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;Wdotu&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wdotu</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kW&#39;</span><span class="p">)</span>         <span class="c1">#\dot{W}^u: Cycle electric power rated capacity [kWe]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;W_delta_plus&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W_delta_plus</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kW/hr&#39;</span><span class="p">)</span>  <span class="c1">#W^{\Delta+}: Power cycle ramp-up designed limit [kWe/h]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;W_delta_minus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W_delta_minus</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kW/hr&#39;</span><span class="p">)</span> <span class="c1">#W^{\Delta-}: Power cycle ramp-down designed limit [kWe/h]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;W_v_plus&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W_v_plus</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kW/hr&#39;</span><span class="p">)</span>      <span class="c1">#W^{v+}: Power cycle ramp-up violation limit [kWe/h]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;W_v_minus&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W_v_minus</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kW/hr&#39;</span><span class="p">)</span>     <span class="c1">#W^{v-}: Power cycle ramp-down violation limit [kWe/h]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;Yu&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Yu</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;hr&#39;</span><span class="p">)</span>   <span class="c1">#Y^u: Minimum required power cycle uptime [h]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;Yd&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Yd</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;hr&#39;</span><span class="p">)</span>   <span class="c1">#Y^d: Minimum required power cycle downtime [h]</span>
        
        <span class="k">return</span> <span class="n">param_dict</span></div>

    
<div class="viewcode-block" id="GeneralDispatchParamWrap.set_fixed_cost_parameters"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.GeneralDispatch.GeneralDispatchParamWrap.set_fixed_cost_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">set_fixed_cost_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to set fixed costs of the Plant</span>
<span class="sd">        </span>
<span class="sd">        This method calculates some fixed costs for the Plant operations, startup,</span>
<span class="sd">        standby, etc. </span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">            param_dict (dict) : dictionary of Pyomo dispatch parameters</span>
<span class="sd">        Outputs:</span>
<span class="sd">            param_dict (dict) : updated dictionary of Pyomo dispatch parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span>
        
        <span class="c1"># TODO: for now, scaling everything from LORE files</span>
        <span class="n">old_P_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PySAM_dict</span><span class="p">[</span><span class="s1">&#39;P_ref_baseline&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">MW</span>
        <span class="n">P_ratio</span>   <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p_pb_design</span> <span class="o">/</span> <span class="n">old_P_ref</span> <span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        
        <span class="c1"># TODO: old values from LORE files</span>
        <span class="n">alpha</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">USD</span>
        <span class="n">C_pc</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PySAM_dict</span><span class="p">[</span><span class="s1">&#39;pc_op_cost&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">USD</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">kWh</span>        
        <span class="n">C_csu</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PySAM_dict</span><span class="p">[</span><span class="s1">&#39;pc_cold_su&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">USD</span>
        <span class="n">C_chsp</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PySAM_dict</span><span class="p">[</span><span class="s1">&#39;pc_hot_su&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">USD</span>
        <span class="n">C_delta_w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PySAM_dict</span><span class="p">[</span><span class="s1">&#39;pc_delta_w&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">USD</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">kW</span>
        <span class="n">C_v_w</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PySAM_dict</span><span class="p">[</span><span class="s1">&#39;pc_delta_w_v&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">USD</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">kW</span>
        <span class="n">C_csb</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PySAM_dict</span><span class="p">[</span><span class="s1">&#39;pc_sb&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">USD</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">kWh</span>

        <span class="c1">### Cost Parameters ###</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span>       <span class="o">=</span> <span class="n">alpha</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;USD&#39;</span><span class="p">)</span>                    <span class="c1">#\alpha: Conversion factor between unitless and monetary values [\$]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;Cpc&#39;</span><span class="p">]</span>         <span class="o">=</span> <span class="n">P_ratio</span> <span class="o">*</span> <span class="n">C_pc</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;USD/kWh&#39;</span><span class="p">)</span>       <span class="c1">#C^{pc}: Operating cost of power cycle [\$/kWe$\cdot$h]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;Ccsu&#39;</span><span class="p">]</span>        <span class="o">=</span> <span class="n">P_ratio</span> <span class="o">*</span> <span class="n">C_csu</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;USD&#39;</span><span class="p">)</span>          <span class="c1">#C^{csu}: Penalty for power cycle cold start-up [\$/start]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;Cchsp&#39;</span><span class="p">]</span>       <span class="o">=</span> <span class="n">P_ratio</span> <span class="o">*</span> <span class="n">C_chsp</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;USD&#39;</span><span class="p">)</span>         <span class="c1">#C^{chsp}: Penalty for power cycle hot start-up [\$/start]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;C_delta_w&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">P_ratio</span> <span class="o">*</span> <span class="n">C_delta_w</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;USD/kW&#39;</span><span class="p">)</span>   <span class="c1">#C^{\delta_w}: Penalty for change in power cycle  production [\$/$\Delta\text{kWe}$]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;C_v_w&#39;</span><span class="p">]</span>       <span class="o">=</span> <span class="n">P_ratio</span> <span class="o">*</span> <span class="n">C_v_w</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;USD/kW&#39;</span><span class="p">)</span>       <span class="c1">#C^{v_w}: Penalty for change in power cycle  production tcb{beyond designed limits} [\$/$\Delta\text{kWe}$]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;Ccsb&#39;</span><span class="p">]</span>        <span class="o">=</span> <span class="n">P_ratio</span> <span class="o">*</span> <span class="n">C_csb</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;USD/kWh&#39;</span><span class="p">)</span>      <span class="c1">#C^{csb}: Operating cost of power cycle standby operation [\$/kWt$\cdot$h]</span>
        
        <span class="k">return</span> <span class="n">param_dict</span></div>


<div class="viewcode-block" id="GeneralDispatchParamWrap.set_initial_state"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.GeneralDispatch.GeneralDispatchParamWrap.set_initial_state">[docs]</a>    <span class="k">def</span> <span class="nf">set_initial_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param_dict</span><span class="p">,</span> <span class="n">updated_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plant</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">npts</span><span class="o">=</span><span class="kc">None</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to set the initial state of the Plant before Dispatch optimization</span>
<span class="sd">        </span>
<span class="sd">        This method uses SSC data to set the initial state of the Plant before Dispatch</span>
<span class="sd">        optimization in Pyomo. This method is called in two ways: once before starting </span>
<span class="sd">        the simulation loop, in which case it only uses values from the SSC_dict portion</span>
<span class="sd">        of the given JSON script. The method is also called within the simulation loop</span>
<span class="sd">        to update the initial state parameters based on the ending conditions of the </span>
<span class="sd">        previous simulation segment (provided by SSC). </span>
<span class="sd">        </span>
<span class="sd">        TODO: can we just input another dictionary instead of passing the full Plant?</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">            param_dict (dict)    : dictionary of Pyomo dispatch parameters</span>
<span class="sd">            updated_dict (dict)  : dictionary with updated SSC initial conditions from previous run</span>
<span class="sd">            plant (obj)          : the full PySAM Plant object </span>
<span class="sd">            npts (int)           : length of the SSC horizon</span>
<span class="sd">        Outputs:</span>
<span class="sd">            param_dict (dict) : updated dictionary of Pyomo dispatch parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span>
        <span class="n">sschm</span>  <span class="o">=</span> <span class="n">SSCHelperMethods</span>
            
        <span class="k">if</span> <span class="n">updated_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_Plant</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SSC_dict</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first_run</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_Plant</span> <span class="o">=</span> <span class="n">updated_dict</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first_run</span> <span class="o">=</span> <span class="kc">False</span>
            
        <span class="c1"># important parameters</span>
        <span class="n">e_pb_suinitremain</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_Plant</span><span class="p">[</span><span class="s1">&#39;pc_startup_energy_remain_initial&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">kWh</span>
        <span class="n">wdot0</span>              <span class="o">=</span> <span class="p">(</span><span class="mi">0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_run</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_Plant</span><span class="p">[</span><span class="s1">&#39;wdot0&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">MW</span> 
        <span class="n">y0</span>                 <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_Plant</span><span class="p">[</span><span class="s1">&#39;pc_op_mode_initial&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> 
        <span class="n">ycsb0</span>              <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_Plant</span><span class="p">[</span><span class="s1">&#39;pc_op_mode_initial&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> 
        <span class="n">ycsu0</span>              <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_Plant</span><span class="p">[</span><span class="s1">&#39;pc_op_mode_initial&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_Plant</span><span class="p">[</span><span class="s1">&#39;pc_op_mode_initial&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> 
        <span class="n">pc_persist</span><span class="p">,</span> <span class="n">pc_off</span> <span class="o">=</span> <span class="n">sschm</span><span class="o">.</span><span class="n">get_pc_persist_and_off_logs</span><span class="p">(</span> <span class="n">param_dict</span><span class="p">,</span> <span class="n">plant</span><span class="p">,</span> <span class="n">npts</span> <span class="p">)</span> <span class="k">if</span> <span class="n">plant</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[</span><span class="mi">48</span><span class="p">,</span><span class="mi">48</span><span class="p">]</span>
        <span class="n">Yu0</span>                <span class="o">=</span> <span class="n">pc_persist</span> <span class="k">if</span> <span class="n">y0</span>       <span class="k">else</span> <span class="mf">0.0</span>
        <span class="n">Yd0</span>                <span class="o">=</span> <span class="n">pc_off</span>     <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">y0</span><span class="p">)</span> <span class="k">else</span> <span class="mf">0.0</span>
        
        <span class="c1"># defining parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wdot0</span> <span class="o">=</span> <span class="n">wdot0</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kW&#39;</span><span class="p">)</span>  <span class="c1">#\dot{w}_0: Initial power cycle electricity generation [kWe] </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y0</span>    <span class="o">=</span> <span class="n">y0</span>              <span class="c1">#y_0: 1 if cycle is generating electric power initially, 0 otherwise   </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ycsb0</span> <span class="o">=</span> <span class="n">ycsb0</span>           <span class="c1">#y^{csb}_0: 1 if cycle is in standby mode initially, 0 otherwise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ycsu0</span> <span class="o">=</span> <span class="n">ycsu0</span>           <span class="c1">#y^{csu}_0: 1 if cycle is in starting up initially, 0 otherwise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Yu0</span>   <span class="o">=</span> <span class="n">Yu0</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">hr</span>        <span class="c1">#Y^u_0: duration that cycle has been generating electric power [h]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Yd0</span>   <span class="o">=</span> <span class="n">Yd0</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">hr</span>        <span class="c1">#Y^d_0: duration that cycle has not been generating power (i.e., shut down or in standby mode) [h]</span>
        
        <span class="c1"># Initial cycle startup energy accumulated</span>
        <span class="n">tol</span> <span class="o">=</span> <span class="mf">1.e-6</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">e_pb_suinitremain</span><span class="p">):</span> <span class="c1"># SSC seems to report NaN when startup is completed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ucsu0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ec</span>
        <span class="k">else</span><span class="p">:</span>   
            <span class="bp">self</span><span class="o">.</span><span class="n">ucsu0</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">MWh</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ec</span> <span class="o">-</span> <span class="n">e_pb_suinitremain</span> <span class="p">)</span> 
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ucsu0</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">tol</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Ec</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ucsu0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ec</span>
        
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;ucsu0&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ucsu0</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kWh&#39;</span><span class="p">)</span>   <span class="c1">#u^{csu}_0: Initial cycle start-up energy inventory  [kWt$\cdot$h]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;wdot0&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wdot0</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kW&#39;</span><span class="p">)</span>    <span class="c1">#\dot{w}_0: Initial power cycle electricity generation [kW]e</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;y0&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span>                <span class="c1">#y_0: 1 if cycle is generating electric power initially, 0 otherwise</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;ycsb0&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ycsb0</span>             <span class="c1">#y^{csb}_0: 1 if cycle is in standby mode initially, 0 otherwise</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;ycsu0&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ycsu0</span>             <span class="c1">#y^{csu}_0: 1 if cycle is in starting up initially, 0 otherwise</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;Yu0&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Yu0</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;hr&#39;</span><span class="p">)</span>      <span class="c1">#Y^u_0: duration that cycle has been generating electric power [h]</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;Yd0&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Yd0</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;hr&#39;</span><span class="p">)</span>      <span class="c1">#Y^d_0: duration that cycle has not been generating power (i.e., shut down or in standby mode) [h]</span>
        <span class="c1"># param_dict[&#39;wdot_s_prev&#39;]    = 0*u.hr         #\dot{w}^{s,prev}: previous $\dot{w}^s$, or energy sold to grid [kWe]</span>
        <span class="c1"># ^ this should be gen[-1] from previous SSC run, 0 if first_run == True</span>
        
        <span class="k">return</span> <span class="n">param_dict</span></div></div>
    
    
<span class="c1"># =============================================================================</span>
<span class="c1"># Dispatch Outputs</span>
<span class="c1"># =============================================================================</span>
  
<div class="viewcode-block" id="GeneralDispatchOutputs"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.GeneralDispatch.GeneralDispatchOutputs">[docs]</a><span class="k">class</span> <span class="nc">GeneralDispatchOutputs</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The GeneralDispatchOutputs class is meant to handle outputs from a given,</span>
<span class="sd">    solved Pyomo Dispatch model. It returns desired outputs in appropriate formats</span>
<span class="sd">    and syntaxes for PostProcessing and linking simulation segments between Pyomo</span>
<span class="sd">    and SSC calls. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="GeneralDispatchOutputs.get_dispatch_targets_from_Pyomo"><a class="viewcode-back" href="../../../simulations.dispatch.html#simulations.dispatch.GeneralDispatch.GeneralDispatchOutputs.get_dispatch_targets_from_Pyomo">[docs]</a>    <span class="k">def</span> <span class="nf">get_dispatch_targets_from_Pyomo</span><span class="p">(</span><span class="n">dispatch_model</span><span class="p">,</span> <span class="n">horizon</span><span class="p">,</span> <span class="n">N_full</span><span class="p">,</span> <span class="n">run_loop</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to set fixed costs of the Plant</span>
<span class="sd">        </span>
<span class="sd">        This method parses through the solved Pyomo model for Dispatch optimization</span>
<span class="sd">        and extracts results that are used as Dispatch Targets in the *SAME* simulation</span>
<span class="sd">        segment but in SSC rather than Pyomo. If we&#39;re not running a loop, we can</span>
<span class="sd">        still update SSC only I guess this happens once for whatever Pyomo horizon</span>
<span class="sd">        is defined (this might not be a feature we keep long-term, perhaps only for</span>
<span class="sd">                    debugging). </span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">            dispatch_model (Pyomo model) : solved Pyomo Dispatch model (ConcreteModel)</span>
<span class="sd">            horizon (float Quant)        : length of time of horizon, whether SSC or Pyomo (in hours)</span>
<span class="sd">            N_full (int)                 : length of full simulation time (in hours, no Quant)</span>
<span class="sd">            run_loop (bool)              : flag to determine if simulation is segmented</span>
<span class="sd">        Outputs:</span>
<span class="sd">            disp_targs (dict) : dictionary of dispatch target arrays for use in SSC </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">dm</span> <span class="o">=</span> <span class="n">dispatch_model</span>
        
        <span class="c1"># range of pyomo and SSC horizon times</span>
        <span class="n">t_pyomo</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">T</span>
        <span class="n">f_ind</span>   <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="n">horizon</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;hr&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">m</span> <span class="p">)</span> <span class="c1"># index in hours of final horizon (e.g. 24)</span>
        <span class="n">t_horizon</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">f_ind</span><span class="p">)</span>
        
        <span class="c1"># if we&#39;re not running a loop, define a list of 0s to pad the output so it matches full array size</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">run_loop</span><span class="p">:</span>
            <span class="n">N_leftover</span> <span class="o">=</span> <span class="n">N_full</span> <span class="o">-</span> <span class="n">f_ind</span>
            <span class="n">empty_array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">N_leftover</span>
        
        <span class="c1">#----Receiver Binary Outputs----</span>
        <span class="n">yn</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pe</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">dm</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">yn</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>   <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_pyomo</span><span class="p">])</span>
        <span class="n">ynsu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pe</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">dm</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ynsu</span><span class="p">[</span><span class="n">t</span><span class="p">])</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_pyomo</span><span class="p">])</span>
        <span class="n">ynsb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pe</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">dm</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ynsb</span><span class="p">[</span><span class="n">t</span><span class="p">])</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_pyomo</span><span class="p">])</span>
        
        <span class="c1">#----Cycle Binary Outputs----</span>
        <span class="n">y</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pe</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">dm</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_pyomo</span><span class="p">])</span>
        <span class="n">ycsu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pe</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">dm</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ycsu</span><span class="p">[</span><span class="n">t</span><span class="p">])</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_pyomo</span><span class="p">])</span>
        <span class="n">ycsb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pe</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">dm</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ycsb</span><span class="p">[</span><span class="n">t</span><span class="p">])</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_pyomo</span><span class="p">])</span>
    
        <span class="c1">#----Cycle Thermal Power Utilization----</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pe</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">dm</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>   <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_pyomo</span><span class="p">])</span><span class="o">/</span><span class="mf">1000.</span> <span class="c1"># from kWt -&gt; MWt</span>
        
        <span class="c1">#----Thermal Capacity for Cycle Startup and Operation----</span>
        <span class="n">Qc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pe</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">dm</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Qc</span><span class="p">[</span><span class="n">t</span><span class="p">])</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_pyomo</span><span class="p">])</span><span class="o">/</span><span class="mf">1000.</span> <span class="c1"># from kWt -&gt; MWt</span>
        <span class="n">Qu</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Qu</span><span class="o">.</span><span class="n">value</span><span class="o">/</span><span class="mf">1000.</span> <span class="c1"># from kWt -&gt; MWt</span>
    
        <span class="c1"># dispatch target -- nuclear startup/standby binaries</span>
        <span class="n">is_nuc_su_allowed_in</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="k">if</span> <span class="p">(</span><span class="n">yn</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">ynsu</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">ynsb</span><span class="p">[</span><span class="n">t</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">0.001</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_horizon</span><span class="p">]</span>  <span class="c1"># Nuclear on, startup, or standby</span>
        <span class="n">is_nuc_sb_allowed_in</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="k">if</span> <span class="n">ynsb</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.001</span>                     <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_horizon</span><span class="p">]</span>  <span class="c1"># Nuclear standby</span>
        
        <span class="c1"># dispatch target -- cycle startup/standby binaries</span>
        <span class="n">is_pc_su_allowed_in</span>  <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="k">if</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">ycsu</span><span class="p">[</span><span class="n">t</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">0.001</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_horizon</span><span class="p">]</span>  <span class="c1"># Cycle on or startup</span>
        <span class="n">is_pc_sb_allowed_in</span>  <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="k">if</span> <span class="n">ycsb</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.001</span>          <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_horizon</span><span class="p">]</span>  <span class="c1"># Cycle standby</span>
    
        <span class="c1"># dispatch target -- cycle thermal inputs and capacities</span>
        <span class="n">q_pc_target_su_in</span>    <span class="o">=</span> <span class="p">[</span><span class="n">Qc</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="k">if</span> <span class="n">ycsu</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.001</span> <span class="k">else</span> <span class="mf">0.0</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_horizon</span><span class="p">]</span>
        <span class="n">q_pc_target_on_in</span>    <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>                              <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_horizon</span><span class="p">]</span>
        <span class="n">q_pc_max_in</span>          <span class="o">=</span> <span class="p">[</span><span class="n">Qu</span>                                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_horizon</span><span class="p">]</span>
        
        <span class="c1"># empty dictionary for output</span>
        <span class="n">disp_targs</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="c1"># if we&#39;re running full simulation in steps, save SSC horizon portion of Pyomo horizon results</span>
        <span class="k">if</span> <span class="n">run_loop</span><span class="p">:</span>
            <span class="n">disp_targs</span><span class="p">[</span><span class="s1">&#39;is_rec_su_allowed_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">is_nuc_su_allowed_in</span> 
            <span class="n">disp_targs</span><span class="p">[</span><span class="s1">&#39;is_rec_sb_allowed_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">is_nuc_sb_allowed_in</span>
            <span class="n">disp_targs</span><span class="p">[</span><span class="s1">&#39;is_pc_su_allowed_in&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">is_pc_su_allowed_in</span> 
            <span class="n">disp_targs</span><span class="p">[</span><span class="s1">&#39;is_pc_sb_allowed_in&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">is_pc_sb_allowed_in</span>  
            <span class="n">disp_targs</span><span class="p">[</span><span class="s1">&#39;q_pc_target_su_in&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="n">q_pc_target_su_in</span>  
            <span class="n">disp_targs</span><span class="p">[</span><span class="s1">&#39;q_pc_target_on_in&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="n">q_pc_target_on_in</span>
            <span class="n">disp_targs</span><span class="p">[</span><span class="s1">&#39;q_pc_max_in&#39;</span><span class="p">]</span>          <span class="o">=</span> <span class="n">q_pc_max_in</span>
        <span class="c1"># if we&#39;re running full simulation all at once, need arrays to match size of full sim</span>
        <span class="c1"># TODO: is this a feature we want in the long term? Or just for debugging the first Pyomo call?</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">disp_targs</span><span class="p">[</span><span class="s1">&#39;is_rec_su_allowed_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span> <span class="p">[</span><span class="n">is_nuc_su_allowed_in</span> <span class="p">,</span> <span class="n">empty_array</span><span class="p">]</span> <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">disp_targs</span><span class="p">[</span><span class="s1">&#39;is_rec_sb_allowed_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span> <span class="p">[</span><span class="n">is_nuc_sb_allowed_in</span> <span class="p">,</span> <span class="n">empty_array</span><span class="p">]</span> <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">disp_targs</span><span class="p">[</span><span class="s1">&#39;is_pc_su_allowed_in&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span> <span class="p">[</span><span class="n">is_pc_su_allowed_in</span>  <span class="p">,</span> <span class="n">empty_array</span><span class="p">]</span> <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">disp_targs</span><span class="p">[</span><span class="s1">&#39;is_pc_sb_allowed_in&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span> <span class="p">[</span><span class="n">is_pc_sb_allowed_in</span>  <span class="p">,</span> <span class="n">empty_array</span><span class="p">]</span> <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">disp_targs</span><span class="p">[</span><span class="s1">&#39;q_pc_target_su_in&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span> <span class="p">[</span><span class="n">q_pc_target_su_in</span>    <span class="p">,</span> <span class="n">empty_array</span><span class="p">]</span> <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">disp_targs</span><span class="p">[</span><span class="s1">&#39;q_pc_target_on_in&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span> <span class="p">[</span><span class="n">q_pc_target_on_in</span>    <span class="p">,</span> <span class="n">empty_array</span><span class="p">]</span> <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">disp_targs</span><span class="p">[</span><span class="s1">&#39;q_pc_max_in&#39;</span><span class="p">]</span>          <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span> <span class="p">[</span><span class="n">q_pc_max_in</span>          <span class="p">,</span> <span class="n">empty_array</span><span class="p">]</span> <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            
        <span class="k">return</span> <span class="n">disp_targs</span></div></div>
    
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">NE-2 Simulations  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">simulations.dispatch.GeneralDispatch</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2021, Gabriel J. Soto, Una Baker, Grace Stanke, Ben Lindley, Mike Wagner.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.2.0.
    </div>
  </body>
</html>